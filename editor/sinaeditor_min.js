window.SinaEditor||(SinaEditor={}),SinaEditor.CONF||(SinaEditor.CONF={}),SinaEditor.CONF.redoConf=100,SinaEditor.CONF.bubbleStyles=[".se_bubble {","background-color:#E0ECFF;","font-family:Arial,sans-serif,sans;","font-size:13px;","position:absolute;","border:1px solid #99C0FF;","padding:3px;","z-index:1000;","-moz-border-radius: 5px;","-khtml-border-radius: 5px;","-webkit-border-radius: 5px;","border-radius: 5px;","}"].join(""),SinaEditor.CONF.bubbleClassName="se_bubble";var href=window.location.href,loc=href.substring(0,href.lastIndexOf("/"));SinaEditor.CONF.STYLELOC=loc+"/style/",SinaEditor.CONF.transparentIMG=SinaEditor.CONF.STYLELOC+"imgs/SG_line.gif",SinaEditor.CONF.fakeFLASH=SinaEditor.CONF.STYLELOC+"imgs/fake_flash.png",SinaEditor.CONF.aBubbleTemplete=['<div class="se_bubble_a_panel">',"<div>","<div>","<span>转到链接：</span>",'<span style="color: black;">','<a class="se_bubble_a_link" href="#{src}" target="_blank">',"#{srcstr}","</a>","</span>","<span>","&nbsp;&nbsp;",'<span class="se_bubble_a_link" id="#{modifyid}">更改</span>',"</span>","<span>","&nbsp;&nbsp;",'<span class="se_bubble_a_link" id="#{deleteid}">删除</span>',"</span>","</div>","</div>","</div>"].join(""),SinaEditor.CONF.mailBubbleTemplete=['<div class="se_bubble_a_panel">',"<div>","<div>",'<span id="tr_link-text" style="color: black;">',"#{srcstr}","</span>","<span>","&nbsp;&nbsp;",'<span class="se_bubble_a_link" id="#{modifyid}">更改</span>',"</span>","<span>","&nbsp;&nbsp;",'<span class="se_bubble_a_link" id="#{deleteid}">删除</span>',"</span>","</div>","</div>","</div>"].join(""),SinaEditor.CONF.imgBubbleTemplete=['<div class="se_bubble_a_panel">',"<div>","<div>","<span>",'<span class="se_bubble_a_link" id="#{modifyid}">更改图片</span>',"</span>","<span>","&nbsp;&nbsp;",'<span class="se_bubble_a_link" id="#{deleteid}">删除图片</span>',"</span>","</div>","</div>","</div>"].join(""),SinaEditor.CONF.flashBubbleTemplete=['<div class="se_bubble_a_panel">',"<div>",'<div style="float:left;">',"<span>",'<span class="se_bubble_a_link" id="#{seeid}">查看影片&nbsp;-&nbsp;</span>',"</span>","<span>",'<span class="se_bubble_a_link" id="#{deleteid}">删除影片</span>',"</span>",'<div style="border:1px solid;display:none;" id="#{showflash}"></div>',"</div>",'<img id="#{closeid}" src="',SinaEditor.CONF.STYLELOC,'imgs/bubble_closebox.gif" style="padding:3px;float:left;">',"</div>","</div>"].join(""),SinaEditor.CONF.aBubbleStyles=[".se_bubble_a_panel{","}",".se_bubble_a_link{","color:#0000CC;","cursor:pointer;","font-size:100%;","}"].join(""),SinaEditor.STATE||(SinaEditor.STATE={}),SinaEditor.STATE.CREATING=1,SinaEditor.STATE.CREATED=2,SinaEditor.STATE.EDITING=3,SinaEditor.STATE.SHOWSOURCE=4,SinaEditor.NODETYPE||(SinaEditor.NODETYPE={}),SinaEditor.NODETYPE.ELEMENT=1,SinaEditor.NODETYPE.TEXT=3,SinaEditor.NODETYPE.HTMLELEMENT=9,SinaEditor.MOUSEKEY||(SinaEditor.MOUSEKEY={}),SinaEditor.MOUSEKEY.LEFT=1,SinaEditor.MOUSEKEY.MID=2,SinaEditor.MOUSEKEY.RIGHT=3,SinaEditor.BUTTONSTATE||(SinaEditor.BUTTONSTATE={}),SinaEditor.BUTTONSTATE.NORMAL=1,SinaEditor.BUTTONSTATE.DISABLED=2,SinaEditor.BUTTONSTATE.CLICKED=3,SinaEditor.BUTTON||(SinaEditor.BUTTON={}),SinaEditor.BUTTON["default"]=function(a){switch(this.getState()){case SinaEditor.STATE.CREATING:a.setState(SinaEditor.BUTTONSTATE.DISABLED);break;case SinaEditor.STATE.EDITING:a.setState(SinaEditor.BUTTONSTATE.NORMAL);break;case SinaEditor.STATE.SHOWSOURCE:a.setState(SinaEditor.BUTTONSTATE.DISABLED);break;default:a.setState(SinaEditor.BUTTONSTATE.DISABLED)}},SinaEditor.RANGE||(SinaEditor.RANGE={}),SinaEditor.RANGE.BLOCKTAGS={DIV:"1",P:"1",TD:"1",LI:"1",OL:"1",NOBR:"1",BODY:"1"},SinaEditor.RANGE.STYLEOBJECTELEMENTS={IMG:1,HR:1,LI:1,TABLE:1,TR:1,TD:1,TH:1,EMBED:1,OBJECT:1,OL:1,UL:1,A:1,INPUT:1,FORM:1,SELECT:1,TEXTAREA:1,BUTTON:1,FIELDSET:1,THREAD:1,TFOOT:1},SinaEditor.RANGE.SKIPTAGS={IMG:"1",BR:"1",TABLE:"1",CAPTION:"1",COL:"1",COLGROUP:"1",TBODY:"1",TFOOT:"1",TH:"1",THREAD:"1",TR:"1",UL:"1"},SinaEditor.RANGE.blockBoundaryDisplayMatch={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},SinaEditor.TOOLCONF||(SinaEditor.TOOLCONF={}),SinaEditor.TOOLCONF.COLOR={"000000":"黑",8e5:"褐红","8B4513":"深褐","2F4F4F":"墨绿","008080":"绿松石","000080":"海军蓝","4B0082":"靛蓝",696969:"暗灰",B22222:"砖红",A52A2A:"褐",DAA520:"金黄","006400":"深绿","40E0D0":"蓝绿","0000CD":"中蓝",800080:"紫",808080:"灰",F00:"红",FF8C00:"深橙",FFD700:"金","008000":"绿","0FF":"青","00F":"蓝",EE82EE:"紫罗兰",A9A9A9:"深灰",FFA07A:"亮橙",FFA500:"橙",FFFF00:"黄","00FF00":"水绿",AFEEEE:"粉蓝",ADD8E6:"亮蓝",DDA0DD:"梅红",D3D3D3:"淡灰",FFF0F5:"淡紫红",FAEBD7:"古董白",FFFFE0:"淡黄",F0FFF0:"蜜白",F0FFFF:"天蓝",F0F8FF:"淡蓝",E6E6FA:"淡紫",FFF:"白"},SinaEditor.TOOLCONF.FONTFAMILYDEF="字体",SinaEditor.TOOLCONF.FONTFAMILYCONF=[{html:"宋体"},{html:"黑体"},{html:"隶书"},{html:"楷体",style:"楷体_GB2312,楷体"},{html:"幼圆"},{html:"Arial"},{html:"Impact"},{html:"Georgia"},{html:"Verdana"},{html:"Courier New"},{html:"Times New Roman"}],SinaEditor.TOOLCONF.FONTSIZEDEF="字号",SinaEditor.TOOLCONF.FONTSIZECONF=[{html:"10px"},{html:"12px"},{html:"14px"},{html:"16px"},{html:"18px"},{html:"20px"},{html:"22px"},{html:"24px"},{html:"32px"},{html:"56px"}],SinaEditor.TOOLCONF.linkTemplate=['<div class="linkItemContent">','<div class="row1" id="#{hidden}" style="display:none">文字:','<input class="fm1" id="#{text}">',"</div>",'<div class="row2">链接:','<input value="http://" class="fm1" id="#{link}">',"</div>",'<div class="row3">','<a onclick="return false" id="#{ok}" href="#" class="SG_aBtn SG_aBtnB"><cite>确定</cite></a>','<a onclick="return false" id="#{cancel}" href="#" class="SG_aBtn SG_aBtnB"><cite>取消</cite></a>',"</div>","</div>"].join(""),SinaEditor.TOOLCONF.addLinkNow=/.*(http|ftp|https|mailto)\:\/\/.*/i,SinaEditor.TOOLCONF.imgType=/.*\.(gif|bmp|png|jpg)$/i,SinaEditor.TOOLCONF.imgErrTypeMSG="上传类型仅仅支持gif,bmp,png,jpg",SinaEditor.TOOLCONF.imgTemplate=['<div class="insetPhotoContent insetPhotoContent_l">','<div id="headerTab" class="headerTab">',"<h4>图片来源：</h4>",'<ul><li class="cur" id="#{tabMy}"><a href="#" onclick="return false;">我的电脑</a></li><li id="#{tabWeb}" class=""><a href="#" onclick="return false;">网上图片</a></li></ul></div>','<div style="display:none" id="#{errTips}" class="errTips"></div>',"<!--出错提示-->",'<div id="#{useClient}" class="urlPath">','<div id="#{clientView}">',"<span>选择本地图片：</span>",'<div id="#{clientUploadDiv}" class="clientUploadDiv" >','<iframe id="#{clientIframe}" name="#{clientIframe}" style="display:none" ></iframe>','<form target="#{clientIframe}" id="#{clientForm}" action="postImg.php" method="POST" enctype="multipart/form-data">','<input type="file" name="imgFile" class="imgFile" id="#{clientFile}">','<textarea name="imgValue" style="display:none" id="#{clientFileDrag}"></textarea>',"</form>",'<div>点击这里选择文件。请配置上传地址，否则上传会失败。<span id="#{clientMoreUp}" style="display:none;">你也可以拖拽上传</span></div>',"</div>","</div>",'<div id="#{contentLoading}" style="display:none">','<div class="loading"></div>','<a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="#" onclick="return false;">','<cite id="#{cancleClient}">取消上传</cite>',"</a>","</div>",'<div id="#{clientResult}" style="display:none">','<div class="clientImg">','<img id="#{resultPic}">',"</div>",'<a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="#" onclick="return false;">','<cite id="#{addClientPic}">添加</cite>',"</a>",'<a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="#" onclick="return false;">','<cite id="#{resetClient}">重新上传</cite>',"</a>","</div>","</div>",'<div style="display: none;" id="#{webContent}" class="urlPath">',"<div>","<span>输入图片地址：</span>",'<input type="text" class="fmTxt" value="http://" id="#{webUrl}" maxlength="400">','<a id="#{webAdd}" style="display:none;" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;">',"<cite>添加</cite>","</a>","</div>",'<div class="webImg" style="display:none;">','<img id="#{webPic}">',"</div>",'<div id="#{webPicLoading}" class="webImgLoad" style="display:none;"></div>',"</div>","</div>"].join(""),SinaEditor.TOOLCONF.flashTemplate=['<div class="linkItemContent">','<div class="row1">HTML代码:','<input class="fm1" style="width:100%;margin-top:3px" id="#{flashSrc}">',"</div>",'<div class="row1">','<span style="color:red;display:none" id="#{flashErrTip}">*请输入flash代码</span>',"</div>",'<div class="row3">','<a onclick="return false" href="#" class="SG_aBtn SG_aBtnB"><cite id="#{ok}">确定</cite></a>','<a onclick="return false" href="#" class="SG_aBtn SG_aBtnB"><cite id="#{cancel}">取消</cite></a>',"</div>","</div>"].join(""),SinaEditor.TOOLCONF.tableTemplate=['<div id="#{panel}" class="se_tab_tableContent">','<div id="#{eventContent}" class="se_tab_eventContent">','<div style="width: 100%; height: 100%;">','<div class="se_tab_mainContent"></div>','<div id="#{baseContent}" class="se_tab_baseContent"></div>','<div id="#{chooseContent}" class="se_tab_chooseContent"></div>',"</div>","</div>",'<div class="num" id="#{tabNums}"> 0 x 0 </div>',"</div>"].join(""),SinaEditor.TOOLCONF.faceTemplate='<div class="se_face_bubble" id="#{panel}"></div>',SinaEditor.TOOLCONF.faceSrc=[{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7400ZH00SIGG.gif",title:"左哼哼"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7401ZH00SIGG.gif",title:"右哼哼"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7402ZH00SIGG.gif"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7403ZH00SIGG.gif"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7404ZH00SIGG.gif"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7405ZH00SIGG.gif"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7406ZH00SIGG.gif"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7407ZH00SIGG.gif"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7408ZH00SIGG.gif"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7409ZH00SIGG.gif"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7410ZH00SIGG.gif"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7411ZH00SIGG.gif"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7412ZH00SIGG.gif"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7413ZH00SIGG.gif"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7414ZH00SIGG.gif"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7415ZH00SIGG.gif"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7416ZH00SIGG.gif"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7417ZH00SIGG.gif"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7418ZH00SIGG.gif"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7419ZH00SIGG.gif"},{src:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7420ZH00SIGG.gif"}],SinaEditor.TOOLCONF.historyMax=5,SinaEditor.TOOLCONF.historyTemplate='<div class="se_history_bubble" id="#{panel}"></div>',window.console||(console={},console.log=function(){}),window.SinaEditor||(SinaEditor={}),SinaEditor.env||(SinaEditor.env={}),function(a){var b=navigator.userAgent.toLowerCase();a.$IE=/msie/.test(b),a.$OPERA=/opera/.test(b),a.$GENKO=/gecko\//.test(b),a.$WEBKIT=/applewebkit/.test(b),a.$IE5=/msie 5 /.test(b),a.$IE6=/msie 6/.test(b),a.$IE7=/msie 7/.test(b),a.$IE8=/msie 8/.test(b),a.$winXP=/windows nt 5.1/.test(b),a.$winVista=/windows nt 6.0/.test(b),a.$FF=/firefox/i.test(b),a.$CHROME=/chrome\//i.test(b),a.$SAFARI=/safari/.test(b)&&!a.$CHROME,a.$TT=/tencenttraveler/.test(b),a.$360=/360se/.test(b),a.$Maxthon=!1;try{var c=window.external;a.$Maxthon=c.max_version?!0:!1}catch(d){}a.isCustomDomain=function(){var a=document.domain,b=window.location.hostname;return this.ie&&a!==b&&a!=="["+b+"]"}()}(SinaEditor.env),window.SinaEditor||(SinaEditor={}),SinaEditor.ev={},function(a){var b={};a.customEvent={};var c={},d={},e={},f=function(b,c,e){var f=d[b];return function(b,d){var g=f[b.type]||[],h=0;d=d||e,d.unshift(a.fixEvent(b));for(h=0;g[h];h++)g[h].func.apply(c,d);d.pop()}},g=function(a,c,d,e){b[c]||(a.removeEventListener?a.removeEventListener(c,d,!1):a.detachEvent?a.detachEvent("on"+c,d,!1):a["on"+c]=null)},h=function(a){var b=null;for(b in c)if(c[b]===a)return b;return null};a.fixEvent=function(a){if(!a.target){try{a.target=a.srcElement;if(a.button)switch(a.button){case 1:a.which=SinaEditor.MOUSEKEY.LEFT;break;case 4:a.which=SinaEditor.MOUSEKEY.MID;break;case 2:a.which=SinaEditor.MOUSEKEY.RIGHT}}catch(a){}a.pageX=a.x,a.pageY=a.y}typeof a.layerX=="undefined"&&(a.layerX=a.offsetX),typeof a.layerY=="undefined"&&(a.layerY=a.offsetY);return a},a.stopEvent=function(a){a.cancelBubble=!0,a.returnValue=!1},SinaEditor.env.$IE||(a.stopEvent=function(a){a.preventDefault(),a.stopPropagation()}),a.add=function(a,g,i,j){j=j||{},j.content=j.content||a;var k=h(a);k||(k=SinaEditor.util.uniqueKey(),c[k]=a,d[k]={});var l=d[k];if(!l[g]){l[g]=[],j.args=j.args||[];if(Object.prototype.toString.apply(j.args)!=="[object Array]")throw new Exception("opt.args 必须是数组");e[k]=f(k,j.content,j.args),b[g]||(a.addEventListener?a.addEventListener(g,e[k],!1):a.attachEvent?a.attachEvent("on"+g,e[k],!1):a["on"+g]=e[k])}if(l[g].length&&j.once)return-1;var m=SinaEditor.util.uniqueKey();l[g].push({func:i,id:m});return m},a.remove=function(a,b,c,e){var f=h(a);if(!!f){var i=d[f];if(!c){delete i[b],g(a,b,c,e);return}var j=i[b];if(j){var k=typeof c=="function"?"func":"id",l;for(l=0;j[l];l++)if(j[l][k]===c){i[b].splice(l,1);break}SinaEditor.util.isEmptyObject(i[b])&&(delete i[b],g(a,b,c,e))}}},a.fire=function(a,c,d){if(b[c]){d=d||{};var f=h(a);f&&e[f]({type:c},d.args)}else if(a.fireEvent)a.fireEvent("on"+c);else{var g=a.ownerDocument.createEvent("HTMLEvents");g.initEvent(c,!0,!0),a.dispatchEvent(g)}},a.$regEvent=function(c,d){var e,f,g,h,i;if(!!a.customEvent[c]){b[c]||(b[c]={}),b[c][d.option.id]||(b[c][d.option.id]=[]);var j=SinaEditor.util.uniqueKey();e=a.customEvent[c](d);if(!e)return;for(h=0;e[h];h++){f=e[h],g=f.events;for(i in g)g.hasOwnProperty(i)&&a.add(f.enty,i,g[i])}}}}(SinaEditor.ev),window.SinaEditor||(SinaEditor={}),function(){function a(a){function b(){}b.prototype=a;return new b}Function.prototype.$define=function(a){var b;for(b in a)a.hasOwnProperty(b)&&(this.prototype[b]=a[b]);if(this.__interface__)for(b in this.prototype)if(this.prototype[b]==="NI")throw new Error("类定义错误，接口方法["+b+"]未实现");this.prototype.constructor=this,this.$extends=this.$define=this.$implements=function(){throw new Error("$define语句定义后面不能再作其它定义")};return this},Function.prototype.$extends=function(){var b=this,c=arguments.length,d,e;if(c===0)throw new Error("$extends语句错误：未指定父类");d=arguments[0],e=function(){d.apply(this,arguments),b.apply(this,arguments)},e.prototype=a(d.prototype),e.prototype.constructor=e,e.$super=d.prototype;return e},Function.prototype.$implements=function(){var a=Array.prototype.slice.call(arguments,0),b,c=a.length,d;while(c--){if(typeof a[c]!="object")throw new Error("$implements语句错误：参数必须为object类型");for(d in a[c])typeof this.prototype[d]=="undefined"&&(this.prototype[d]="NI")}this.__interface__=!0,this.$extends=function(){throw new Error("$extends语句错误:$extends语句不能出现在$implements定义之后")};return this}}(),window.SinaEditor||(SinaEditor={}),SinaEditor.pkg=function(a,b){if(!a||!a.length)return null;var c=a.split("."),d=SinaEditor,e;for(e=c[0]=="SinaEditor"?1:0;e<c.length;++e)d[c[e]]=d[c[e]]||{},d=d[c[e]];b&&b(d);return d},SinaEditor.pkg("SinaEditor.operation"),SinaEditor.util||(SinaEditor.util={}),SinaEditor.pkg("SinaEditor.util",function(ns){ns.isEmptyObject=function(a){var b;for(b in a)return!1;return!0},ns.uniqueKey=function(){var a=+(new Date)+"",b=a.length;return parseInt(Math.random()*1e4,10)+""+a.substring(b/2,b-1)},ns.trim=function(a){a=a.replace(/^\s\s*/,"");var b=/\s/,c=a.length;while(b.test(a.charAt(--c)));return a.slice(0,c+1)},ns.o2s=function(a){var b=[],c=arguments.callee,d=Object.prototype.toString.call(a);switch(d){case"[object Array]":var e;b.push("[");for(e=0,len=a.length;e<len;e++)b.push(c(a[e])),b.push(",");b[1]&&b.pop(),b.push("]");return b.join("");case"[object Object]":var f;b.push("{");for(f in a)b.push(c(f)),b.push(":"),b.push(c(a[f])),b.push(",");b[1]&&b.pop(),b.push("}");return b.join("");case"[object String]":b.push('"'),b.push(a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"')),b.push('"');return b.join("");case"[object Number]":case"[object Boolean]":return a;default:return a.toString?a.toString():"[unsupported]"}},ns.mix=function(a,b){if(b){var c;for(c in b)a[c]=b[c]}return a},ns.s2o=function(str){try{return eval("("+str+")")}catch(e){return null}}}),SinaEditor.util.styleHTML=function(a,b,c,d){var e,f;e=function(){this.pos=0,this.token="",this.current_mode="CONTENT",this.tags={parent:"parent1",parentcount:1,parent1:""},this.tag_type="",this.token_text=this.last_token=this.last_text=this.token_type="",this.Utils={whitespace:"\n\r\t ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed".split(","),extra_liners:"head,body,/html".split(","),in_array:function(a,b){var c;for(c=0;c<b.length;c++)if(a===b[c])return!0;return!1}},this.get_content=function(){var a="",b=[],c=!1;while(this.input.charAt(this.pos)!=="<"){if(this.pos>=this.input.length)return b.length?b.join(""):["","TK_EOF"];a=this.input.charAt(this.pos),this.pos++,this.line_char_count++;if(this.Utils.in_array(a,this.Utils.whitespace)){b.length&&(c=!0),this.line_char_count--;continue}if(c){if(this.line_char_count>=this.max_char){b.push("\n");var d;for(d=0;d<this.indent_level;d++)b.push(this.indent_string);this.line_char_count=0}else b.push(" "),this.line_char_count++;c=!1}b.push(a)}return b.length?b.join(""):""},this.get_script=function(){var a="",b=[],c=new RegExp("</script>","igm");c.lastIndex=this.pos;var d=c.exec(this.input),e=d?d.index:this.input.length;while(this.pos<e){if(this.pos>=this.input.length)return b.length?b.join(""):["","TK_EOF"];a=this.input.charAt(this.pos),this.pos++,b.push(a)}return b.length?b.join(""):""},this.record_tag=function(a){this.tags[a+"count"]?(this.tags[a+"count"]++,this.tags[a+this.tags[a+"count"]]=this.indent_level):(this.tags[a+"count"]=1,this.tags[a+this.tags[a+"count"]]=this.indent_level),this.tags[a+this.tags[a+"count"]+"parent"]=this.tags.parent,this.tags.parent=a+this.tags[a+"count"]},this.retrieve_tag=function(a){if(this.tags[a+"count"]){var b=this.tags.parent;while(b){if(a+this.tags[a+"count"]===b)break;b=this.tags[b+"parent"]}b&&(this.indent_level=this.tags[a+this.tags[a+"count"]],this.tags.parent=this.tags[b+"parent"]),delete this.tags[a+this.tags[a+"count"]+"parent"],delete this.tags[a+this.tags[a+"count"]],this.tags[a+"count"]==1?delete this.tags[a+"count"]:this.tags[a+"count"]--}},this.get_tag=function(){var a="",b,c=[],d=!1;do{if(this.pos>=this.input.length)return c.length?c.join(""):["","TK_EOF"];a=this.input.charAt(this.pos),this.pos++,this.line_char_count++;if(this.Utils.in_array(a,this.Utils.whitespace)){d=!0,this.line_char_count--;continue}if(a==="'"||a==='"')if(!c[1]||c[1]!=="!")a+=this.get_unformatted(a),d=!0;a==="="&&(d=!1),c.length&&c[c.length-1]!=="="&&a!==">"&&d&&(this.line_char_count>=this.max_char?(this.print_newline(!1,c),this.line_char_count=0):(c.push(" "),this.line_char_count++),d=!1),c.push(a)}while(a!==">");var e=c.join(""),f;e.indexOf(" ")!=-1?f=e.indexOf(" "):f=e.indexOf(">");var g=e.substring(1,f).toLowerCase();e.charAt(e.length-2)==="/"||this.Utils.in_array(g,this.Utils.single_token)?this.tag_type="SINGLE":g==="script"?(this.record_tag(g),this.tag_type="SCRIPT"):g==="style"?(this.record_tag(g),this.tag_type="STYLE"):g==="a"?(b=this.get_unformatted("</a>",e),c.push(b),this.tag_type="SINGLE"):g.charAt(0)==="!"?g.indexOf("[if")!=-1?(e.indexOf("!IE")!=-1&&(b=this.get_unformatted("-->",e),c.push(b)),this.tag_type="START"):g.indexOf("[endif")!=-1?(this.tag_type="END",this.unindent()):g.indexOf("[cdata[")!=-1?(b=this.get_unformatted("]]>",e),c.push(b),this.tag_type="SINGLE"):(b=this.get_unformatted("-->",e),c.push(b),this.tag_type="SINGLE"):(g.charAt(0)==="/"?(this.retrieve_tag(g.substring(1)),this.tag_type="END"):(this.record_tag(g),this.tag_type="START"),this.Utils.in_array(g,this.Utils.extra_liners)&&this.print_newline(!0,this.output));return c.join("")},this.get_unformatted=function(a,b){if(b&&b.indexOf(a)!=-1)return"";var c="",d="",e=!0;do{c=this.input.charAt(this.pos),this.pos++;if(this.Utils.in_array(c,this.Utils.whitespace)){if(!e){this.line_char_count--;continue}if(c==="\n"||c==="\r"){d+="\n";var f;for(f=0;f<this.indent_level;f++)d+=this.indent_string;e=!1,this.line_char_count=0;continue}}d+=c,this.line_char_count++,e=!0}while(d.indexOf(a)==-1);return d},this.get_token=function(){var a;if(this.last_token==="TK_TAG_SCRIPT"){var b=this.get_script();if(typeof b!="string")return b;a=js_beautify(b,{indent_size:this.indent_size,indent_char:this.indent_character,indent_level:this.indent_level});return[a,"TK_CONTENT"]}if(this.current_mode==="CONTENT"){a=this.get_content();return typeof a!="string"?a:[a,"TK_CONTENT"]}if(this.current_mode==="TAG"){a=this.get_tag();if(typeof a!="string")return a;var c="TK_TAG_"+this.tag_type;return[a,c]}},this.printer=function(a,b,c,d){this.input=a||"",this.output=[],this.indent_character=b||" ",this.indent_string="",this.indent_size=c||2,this.indent_level=0,this.max_char=d||70,this.line_char_count=0;var e;for(e=0;e<this.indent_size;e++)this.indent_string+=this.indent_character;this.print_newline=function(a,b){this.line_char_count=0;if(!!b&&!!b.length){if(!a)while(this.Utils.in_array(b[b.length-1],this.Utils.whitespace))b.pop();b.push("\n");var c;for(c=0;c<this.indent_level;c++)b.push(this.indent_string)}},this.print_token=function(a){this.output.push(a)},this.indent=function(){this.indent_level++},this.unindent=function(){this.indent_level>0&&this.indent_level--}};return this},f=new e,f.printer(a,c,b);for(;;){var g=f.get_token();f.token_text=g[0],f.token_type=g[1];if(f.token_type==="TK_EOF")break;switch(f.token_type){case"TK_TAG_START":case"TK_TAG_SCRIPT":case"TK_TAG_STYLE":f.print_newline(!1,f.output),f.print_token(f.token_text),f.indent(),f.current_mode="CONTENT";break;case"TK_TAG_END":f.print_newline(!0,f.output),f.print_token(f.token_text),f.current_mode="CONTENT";break;case"TK_TAG_SINGLE":f.print_newline(!1,f.output),f.print_token(f.token_text),f.current_mode="CONTENT";break;case"TK_CONTENT":f.token_text!==""&&(f.print_newline(!1,f.output),f.print_token(f.token_text)),f.current_mode="TAG"}f.last_token=f.token_type,f.last_text=f.token_text}return f.output.join("")},SinaEditor.util||(SinaEditor.util={},SinaEditor.util.dom={}),SinaEditor.pkg("SinaEditor.util.dom",function(a){function c(a,b){var d=a.scrollTop;return b?a.offsetParent?a.offsetTop+c(a.offsetParent,b)-d:a.offsetTop-d:a.offsetParent?a.offsetTop+c(a.offsetParent,b):a.offsetTop}function b(a,c){var d=a.scrollLeft;return c?a.offsetParent?a.offsetLeft+b(a.offsetParent,c)-d:a.offsetLeft-d:a.offsetParent?a.offsetLeft+b(a.offsetParent,c):a.offsetLeft}a.createDom=function(a,b){b=b||{};var c=(b.ownerDocument||document).createElement(a),d;if(b.attributes)for(d in b.attributes)c.setAttribute(d,b.attributes[d]);if(b.properties)for(d in b.properties)c[d]=b.properties[d];return c},a.containsNode=function(a,b){return a==b?!0:a.contains?a.contains(b):!!(a.compareDocumentPosition(b)&16)},a.getFirst=function(b){b=b.firstChild;return b&&b.nodeType!=SinaEditor.NODETYPE.ELEMENT?a.getNext(b):b},a.getNext=function(a){do a=a.nextSibling;while(a&&a.nodeType!=1);return a},a.parents=function(a){var b=[],c=a.parentNode;while(c.tagName.toUpperCase()!="HTML")b[b.length]=c,c=c.parentNode;return b},a.createDomFromHTML=function(b,c){var d=a.createDom("DIV",{ownerDocument:c});d.innerHTML=b;if(d.firstChild)return d.removeChild(d.firstChild);d.innerHTML="<div>"+b+"</div>";var e=d.firstChild;return e.removeChild(e.firstChild)},a.outerHTML=function(a){if(a.outerHTML){console.log("原生outerHTML");return a.outerHTML}var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(!0));return b.innerHTML},SinaEditor.env.$IE?a.replaceNode=function(a,b){return b.replaceNode(a)}:a.replaceNode=function(a,b){return b.parentNode.replaceChild(a,b)},a.delElement=function(a){var b=a.parentNode;return b?b.removeChild(a):null},a.removeTag=function(a){if(a.nodeType==1){var b=a.parentNode,c=a.childNodes;while(c[0])b.insertBefore(c[0],a);b.removeChild(a)}},a.getBlockParent=function(b){var c=a.parents(b),d=null,e;for(e=0;c[e];e++){if(SinaEditor.RANGE.BLOCKTAGS[c[e].tagName.toUpperCase()])break;d=c[e]}return d},a.insertBefore=function(a,b){b.parentNode.insertBefore(a,b)},a.insertAfter=function(a,b){var c=b.parentNode;c.lastChild==b?c.appendChild(a):c.insertBefore(a,b.nextSibling)},a.getScrollPos=function(a){a=a||document;var b=a.compatMode,c=b==="BackCompat"?a.body:a.documentElement;return[c.scrollTop||a.body.scrollTop,c.scrollLeft||a.body.scrollLeft,c.scrollWidth,c.scrollHeight]},a.$E=function(a,b){var c=typeof a=="string"?(b||document).getElementById(a):a;return c?c:null},a.getXY=function(d,e){if(!e)return[b(d),c(d)];var f,g,h,i=[0,0],j=!0;f=d.ownerDocument,f.parentWindow?(g=f.parentWindow.frameElement,h=g&&g.ownerDocument.parentWindow.frameElement):(g=f.defaultView.frameElement,h=g&&g.ownerDocument.defaultView.frameElement,j=!1);while(g)i[0]+=a.styleInteger(g,"borderLeftWidth"),i[1]+=a.styleInteger(g,"borderTopWidth"),h?(i[0]+=b(g,!0),i[1]+=c(g,!0),g=h,j?h=g.ownerDocument.parentWindow.frameElement:h=g.ownerDocument.defaultView.frameElement):(i[0]+=b(g),i[1]+=c(g),g=h);return[i[0]+b(d,!0),i[1]+c(d,!0)]},a.getChildren=function(b,c){c=c||{},c.eleArr=c.eleArr||[];if(b.nodeType==3&&!c.onlyElement)c.eleArr.push(b);else{var d=b.childNodes,e=0;while(d[e]){var f=d[e];f.nodeType==1?(c.all&&(f.childNodes.length!=1||f.childNodes.length==1&&f.childNodes[0].nodeType!=3)&&(c.eleArr=a.getChildren(f,c)),c.eleArr.push(f)):c.onlyElement||c.eleArr.push(f),e++}}return c.eleArr}}),SinaEditor.pkg("SinaEditor.util.dom",function(a){a.addStyles=function(b,c){var d,e;e=(c||document).getElementsByTagName("head")[0],d=a.createDom("style",{ownerDocument:c,attributes:{type:"text/css"}});try{d.appendChild((c||document).createTextNode(b))}catch(f){d.styleSheet.cssText=b}e.appendChild(d)},a.addLink=function(b,c){var d,e;e=(c||document).getElementsByTagName("head")[0],d=a.createDom("link",{ownerDocument:c,attributes:{rel:"stylesheet",type:"text/css",href:b}}),e.appendChild(d)},a.styleInteger=function(b,c){var d=a.getStyle(b,c);try{return parseInt(d.replace(/[^\d]/g,""),10)||0}catch(e){return 0}},a.getStyle=function(a,b){if(!a)return"";switch(a.nodeType){case SinaEditor.NODETYPE.HTMLELEMENT:return"";case SinaEditor.NODETYPE.TEXT:a=a.parentNode}if(!a||a.tagName.toUpperCase()==="BODY")return"";switch(b){case"opacity":var c=100;try{var d="DXImageTransform.Microsoft.Alpha";c=a.filters[d].opacity}catch(e){try{c=a.filters("alpha").opacity}catch(e){}}return c/100;default:b==="float"&&(b="styleFloat");var f=a.currentStyle?a.currentStyle[b]:null;return a.style[b]||f}},SinaEditor.env.$IE||(a.getStyle=function(a,b){if(!a)return"";switch(a.nodeType){case SinaEditor.NODETYPE.HTMLELEMENT:return"";case SinaEditor.NODETYPE.TEXT:a=a.parentNode}if(!a||a.tagName.toUpperCase()==="BODY")return"";b=="float"&&(b="cssFloat");var c=a.ownerDocument.defaultView.getComputedStyle(a,"");return a.style[b]||c?c[b]:null});var b=function(a){var b=a.split("-"),c=b[0],d;for(d=1;d<b.length;d++)c+=b[d].charAt(0).toUpperCase()+b[d].substring(1);return c};a.removeStyle=function(a,b){b=b.replace(/([A-Z])/,"-$1").toLowerCase();var c=a.style.cssText.toLowerCase().split(";"),d;for(d=0;c[d];d++)if(c[d].indexOf(b)!=-1){c.splice(d,1);break}a.style.cssText=c.join(";");return c.length-1},a.setStyle=function(){var c=arguments[0];if(arguments.length==2){var d,e,f=arguments[1];for(e in f)d=b(e),a.setStyle(c,d,f[e])}else if(arguments.length==3){var g=arguments[1],h=arguments[2];if(!SinaEditor.env.$IE)g=="float"&&(g="cssFloat"),c.style[g]=h;else switch(g){case"opacity":c.style.filter="alpha(opacity="+h*100+")";if(!c.currentStyle||!c.currentStyle.hasLayout)c.style.zoom=1;break;case"float":g="styleFloat";break;default:c.style[g]=h}}}}),SinaEditor.range||(SinaEditor.range={}),SinaEditor.pkg("SinaEditor.range",function(a){function l(a,c,e){console.log("是一个DOM节点"),console.log(c);if(SinaEditor.RANGE.SKIPTAGS[c.tagName.toUpperCase()])return c;var f=c,g=d(a),h=b.createDom(e.useTagName,{ownerDocument:a.entyDoc});e.style&&(h.style[e.style]=e.value);var i=b.getChildren(c,{all:!0,onlyElement:!0});if(c.tagName.toUpperCase()===e.useTagName){console.log("是span");var j=b.getChildren(c,{all:!0,onlyElement:!0}),k=0;while(j[k]){if(j[k].tagName.toUpperCase()===e.useTagName&&!j[k].style.cssText){var l=d(a);l.selectNode(j[k]);var m=a.entyDoc.createTextNode(l.extractContents().textContent);l.insertNode(m),l.detach()}k++}e.style&&(c.style[e.style]=e.value)}else if(SinaEditor.RANGE.BLOCKTAGS[c.tagName.toUpperCase()]){console.log("是块状标签");var n=c.childNodes;if(n.length===1&&n[0].nodeType==SinaEditor.NODETYPE.ELEMENT&&n[0].tagName.toUpperCase()==e.useTagName)console.log("只有一个子节点,且为span"),e.style&&(n[0].style[e.style]=e.value);else{console.log("无子节点或子节点不是span标签"),c.insertBefore(h,n[0]);while(n[1])h.appendChild(n[1]);f=h}}else{console.log("非块状标签");var o=c.parentNode;o&&o.tagName.toUpperCase()==e.useTagName?(console.log("有父节点且是span"),e.style&&(o.style[e.style]=e.value),f=o):(console.log("无父节点或不是span标签"),o.insertBefore(h,c),h.appendChild(c),f=h)}return f}function k(a,c,d){var e=b.createDom(d.useTagName,{ownerDocument:a.entyDoc});d.style&&(e.style[d.style]=d.value);var f=c.parentNode;if(f.tagName.toUpperCase()===d.useTagName){console.log("它的父节点是span!");if(SinaEditor.util.trim(f.textContent||f.innerText)!=SinaEditor.util.trim(c.data)){c.parentNode.insertBefore(e,c),e.appendChild(c);return e}d.style&&(f.style[d.style]=d.value);return f}if(f.tagName.toUpperCase()=="BODY"){console.log("它的父节点是Body!"),c.parentNode.insertBefore(e,c),e.appendChild(c);return e}if(SinaEditor.RANGE.BLOCKTAGS[c.parentNode.tagName.toUpperCase()]){console.log("是块状标签"),c.parentNode.insertBefore(e,c),e.appendChild(c);return e}console.log("非块状标签");var g=f.parentNode;if(g&&g.nodeType===SinaEditor.NODETYPE.ELEMENT&&g.tagName.toUpperCase()==d.useTagName){console.log("它的父节点的父节点是span");if(SinaEditor.util.trim(f.textContent||f.innerText)==SinaEditor.util.trim(c.data)){d.style&&(g.style[d.style]=d.value);return g}c.parentNode.insertBefore(e,c),e.appendChild(c);return e}console.log("它的父节点的父节点不是span，是:"),console.log(g),c.parentNode.insertBefore(e,c),SinaEditor.util.trim(f.textContent||f.innerText)==SinaEditor.util.trim(c.data)?(f.parentNode.insertBefore(e,f),e.appendChild(f)):(c.parentNode.insertBefore(e,c),e.appendChild(c));return e}var b=SinaEditor.util.dom,c={},d=function(a){return a.entyDoc.createRange()};a.getCurrentRanges=function(a){var b=a.getSelection();if(!b)return[];var c=[],d=b.rangeCount;if(!d){var f=a.document.createRange();a.document.body.firstChild||(a.document.body.innerHTML="&#x200b;"),f.selectNode(a.document.body.firstChild),f.collapse(!0);return[f]}var g,h;for(g=0;g<d;g++)h=e(b.getRangeAt(g)),c.push(h);return c};var e=function(a){if(a.collapsed)return a;if(a._range&&a._range.item)return a;if(a._range&&a.startContainer&&a.startContainer.nodeType===SinaEditor.NODETYPE.ELEMENT&&(a.startContainer.tagName.toUpperCase()==="IMG"||a.startContainer.tagName.toUpperCase()==="table"))return a;if(a._range&&a.endContainer&&a.endContainer.nodeType===SinaEditor.NODETYPE.ELEMENT&&(a.endContainer.tagName.toUpperCase()==="IMG"||a.endContainer.tagName.toUpperCase()==="table"))return a;var b=a.cloneRange(),c=a.startContainer,d=f(c);while(d){a.setStartBefore(d);if(a.toString()!==b.toString())break;c=d,d=f(c)}c===b.startContainer?a.setStart(c,b.startOffset):a.setStartBefore(c);var e=a.endContainer,g=f(e);while(g){a.setEndAfter(g);if(a.toString()!==b.toString())break;e=g,g=f(e)}e===b.endContainer?a.setEnd(e,b.endOffset):a.setEndAfter(e),b.detach();return a},f=function(a){var b,c;b=a.parentNode;if(!b||b.nodeType===SinaEditor.NODETYPE.HTMLELEMENT||b.tagName.toUpperCase()==="HTML"||b.tagName.toUpperCase()==="BODY")return null;c=b.parentNode;if(c&&b){var d=c.childNodes;for(var e=0;d[e];e++)if(d[e]===b)return b}return null};a.applyRanges=function(a,b){if(!!b){var c=a.getSelection();c.removeAllRanges();if(b.push){var d;for(d=0;b[d];d++)c.addRange(b[d])}else c.addRange(b)}},a.focusNode=function(a,b){var c=null;if(SinaEditor.env.$IE){var d=a.document.selection.createRange();c=d.item?d.item(0):d.parentElement();return b&&c.nodeType!=1?c.parentNode:c}var e=a.getSelection(),f=[],g=e.rangeCount,h;for(h=0;h<g;h++){c=e.getRangeAt(h).commonAncestorContainer;return b&&c.nodeType!=1?c.parentNode:c}return null},a.getReferNode=function(b,c){c=c||a.getCurrentRanges(b)[0];if(!c)return null;if(c.item)return c.item(0);var d=c.startContainer;switch(d.nodeType){case SinaEditor.NODETYPE.ELEMENT:switch(d.tagName.toUpperCase()){case"BODY":return SinaEditor
.util.dom.getFirst(d);default:return d.parentNode};case SinaEditor.NODETYPE.TEXT:console.log("SinaEditor.NODETYPE.TEXT");var e=d.parentNode;try{e.normalize()}catch(f){}if(e.childNodes.length==1)return e;return d}},a.focus=function(a,b){var c=a.ownerDocument.parentWindow|a.ownerDocument.defaultView,d=c.getSelection(),e=c.document.createRange();b?e.selectNodeContents(a):e.selectNode(a),d.removeAllRanges(),d.addRange(e);return d},a.setStartBefore=function(a,b){var c=a.getSelection(),d=a.document.createRange();d.setStartBefore(b),c.removeAllRanges(),c.addRange(d);return c},a.insertNode=function(a,b){var c=a.getSelection(),d;c.rangeCount>0?d=c.getRangeAt(0):d=a.document.createRange(),d.insertNode(b);return c},a.compareBoundaryPoints=function(a,b,c){if(!a)return-1;if(!b)return 1;c=c||Range.START_TO_END;return a.compareBoundaryPoints(c,b)},a.applyStyle=function(c,d){d.useTagName=d.useTagName||"span";var e=a.getCurrentRanges(c.entyWin)[0];try{c.entyDoc.normalize()}catch(f){}if(e.collapsed){var h=null,m=e.startContainer;m.nodeType===SinaEditor.NODETYPE.ELEMENT&&m.tagName.toUpperCase()===d.useTagName.toUpperCase()&&m.innerHTML==="​"?h=m:(h=b.createDom(d.useTagName,{ownerDocument:c.entyDoc}),h.innerHTML="&#x200b;",e.insertNode(h)),d.style&&(h.style[d.style]=d.value),e.selectNodeContents(h),e.collapse(!1),a.applyRanges(c.entyWin,e),c.focus()}else{var n=i(c,{range:e});n.end&&j.call(c,n.end),j.call(c,n.start),g(n.start,n.end,function(a){a.nodeType==3&&a.data?a=k(c,a,{useTagName:d.useTagName.toUpperCase(),style:d.style,value:d.value}):a.nodeType==1&&(a.textContent||a.innerText)&&(SinaEditor.RANGE.SKIPTAGS[a.tagName.toUpperCase()]||(a=l(c,a,{useTagName:d.useTagName.toUpperCase(),style:d.style,value:d.value})))}),n.end&&(e.setEndBefore(n.end),n.end.parentNode.removeChild(n.end)),e.setStartAfter(n.start),n.start.parentNode.removeChild(n.start),a.applyRanges(c.entyWin,e),c.focus()}},a.queryCommandState=function(b,d){if(!d)return!1;d=d.toLowerCase();return c[d]?c[d](a.getReferNode(b.defaultView||b.parentWindow)):b.queryCommandState(d)},a.regQueryCommandState=function(a,b){a=a.toLowerCase();c[a]||(c[a]=b)},a.removeStyle=function(c,d,e){d.useTagName=d.useTagName||"span";var f={};if(typeof d.useTagName=="string")f[d.useTagName.toUpperCase()]="1";else{var h;for(h=0;d.useTagName[h];h++)f[d.useTagName[h].toUpperCase()]="1"}var k=a.getCurrentRanges(c.entyWin)[0];if(k.collapsed)c.focus();else{var l=i(c,{range:k});try{c.entyDoc.normalize()}catch(m){}e||(j.call(c,l.end),j.call(c,l.start)),g(l.start,l.end,function(a){if(a.nodeType===SinaEditor.NODETYPE.ELEMENT&&f[a.tagName.toUpperCase()])if(d.style){var c=SinaEditor.util.dom.removeStyle(a,d.style);c===0&&b.removeTag(a)}else b.removeTag(a)}),l.end&&(k.setEndBefore(l.end),l.end.parentNode.removeChild(l.end)),k.setStartAfter(l.start),l.start.parentNode.removeChild(l.start),a.applyRanges(c.entyWin,k),c.focus()}};var g=function(a,b,c){var d=h(a,!0);while(d&&d!=b){var e=d;d=h(d),(e.nodeType===SinaEditor.NODETYPE.TEXT||e.nodeType===SinaEditor.NODETYPE.ELEMENT&&!SinaEditor.util.dom.containsNode(e,b))&&c(e)}},h=function(a,b){if(a.hasChildNodes()&&!b){var c=a.firstChild;if(c)return c}var d=a.nextSibling;while(!d){d=a.parentNode;if(d.tagName.toUpperCase()=="HTML")throw"确定在遍历节点时有结束标记的节点?";a=d,d=a.nextSibling}return d},i=function(c,e){e=e||{};var f,g,h;f=b.createDom("span",{ownerDocument:c.entyDoc,properties:{id:"start",innerHTML:"&nbsp;"},attributies:{_se_mark:1}}),f.style.color="#FF0000",e.range=e.range||d(c),g=b.createDom("span",{ownerDocument:c.entyDoc,properties:{id:"end",innerHTML:"&nbsp;"},attributies:{_se_mark:2}}),g.style.color="#FF0000";if(!e.range._document)h=e.range.cloneRange(),h.collapse(!1),h.insertNode(g),h=e.range.cloneRange(),h.collapse(!0),h.insertNode(f);else{var i=e.range.startContainer,j=e.range.startOffset,k=e.range.endContainer,l=e.range.endOffset,m=e.range.__getRefA(),n=k.nodeType===SinaEditor.NODETYPE.ELEMENT?k.childNodes[l]:null,o=i.nodeType===SinaEditor.NODETYPE.ELEMENT?i.childNodes[j]:null;h=e.range.cloneRange(),h.collapse(!1),h.insertNode(g),o?i.insertBefore(f,o):(h=e.range.cloneRange(),h.collapse(!0),h.insertNode(f))}e.range.setStartAfter(f),e.range.setEndBefore(g),a.applyRanges(c.entyWin,e.range);return{start:f,end:g}},j=function(a){var c=b.getBlockParent(a);if(!c)return!1;var e=d(this);if(e._range)return!1;e.setStartAfter(a),e.setEndAfter(c);var f=e.extractContents();e.insertNode(b.delElement(a)),b.insertAfter(f,a);return!0}}),SinaEditor.ev.customEvent.ctrlb=function(a){return[{enty:a.entyDoc,events:{keydown:function(b){b.ctrlKey&&b.keyCode==66&&(SinaEditor.ev.stopEvent(b),SinaEditor.ev.fire(a,"ctrlb"))}}}]},SinaEditor.ev.customEvent.ctrli=function(a){return[{enty:a.entyDoc,events:{keydown:function(b){b.ctrlKey&&b.keyCode==73&&(SinaEditor.ev.stopEvent(b),SinaEditor.ev.fire(a,"ctrli"))}}}]},SinaEditor.ev.customEvent.ctrls=function(a){return[{enty:a.entyDoc,events:{keydown:function(b){b.ctrlKey&&b.keyCode==83&&(SinaEditor.ev.stopEvent(b),SinaEditor.ev.fire(a,"ctrls"))}}}]},SinaEditor.ev.customEvent.ctrly=function(a){return[{enty:a.entyDoc,events:{keydown:function(b){b.ctrlKey&&b.keyCode==89&&(SinaEditor.ev.stopEvent(b),SinaEditor.ev.fire(a,"ctrly"))}}}]},SinaEditor.ev.customEvent.ctrlz=function(a){return[{enty:a.entyDoc,events:{keydown:function(b){b.ctrlKey&&b.keyCode==90&&(SinaEditor.ev.stopEvent(b),SinaEditor.ev.fire(a,"ctrlz"))}}}]},SinaEditor.ev.customEvent.editorHasSelection=function(a){function b(){a.entyWin.clearTimeout(a._.editorHasSelectionBufferTimmer),a._.editorHasSelectionBufferTimmer=a.entyWin.setTimeout(function(){console.log("空闲1秒检测");var b=SinaEditor.range.getCurrentRanges(a.entyWin),c;for(c=0;b[c];c++)if(!b[c].collapsed){console.log("出现了选区");return}console.log("没有选区")},1e3)}},SinaEditor.ev.customEvent.editorOnladed=function(a){},SinaEditor.ev.customEvent.editorSelectionChange=function(a){var b=function(b){a.entyWin.clearTimeout(a._.editorHasSelectionBufferTimmer),a._.editorHasSelectionBufferTimmer=a.entyWin.setTimeout(function(){var d=SinaEditor.range.getCurrentRanges(a.entyWin),f=d[0],g;a._.oldRange?(g=a._.oldRange[0],(f||g)&&SinaEditor.range.compareBoundaryPoints(f,g)!==0&&(console.log("两个range不相等"),c.call(a,b,f))):(console.log("两个range不相等"),c.call(a,b,f)),a._.oldRange=d},400);return!1},c=function(b,c){b=SinaEditor.ev.fixEvent(b),SinaEditor.ev.fire(a,"editorSelectionChange",{args:[c,SinaEditor.range.getReferNode(this.entyWin,c)]})};return[{enty:a.entyDoc,events:{mouseup:b,keyup:b}}]},SinaEditor.ev.customEvent.editorStateChange=function(a){},SinaEditor.ev.customEvent.redoAndUndoChanged=function(a){},SinaEditor.$abstract||(SinaEditor.$abstract={}),SinaEditor.$abstract.$BaseBubble=function(){this.enbad=SinaEditor.util.dom.createDom("div"),this.enbad.style.display="none";var a=this;document.body?document.body.appendChild(a.enbad):SinaEditor.ev.add(window,"load",function(b){document.body.appendChild(a.enbad)})}.$define({showBubble:function(a,b){typeof a=="string"?this.enbad.innerHTML=a:this.enbad.appendChild(a),this.enbad.style.left=b.x+"px";var c=SinaEditor.util.dom.styleInteger(this.enbad,"paddingTop")+SinaEditor.util.dom.styleInteger(this.enbad,"paddingBottom")+SinaEditor.util.dom.styleInteger(this.enbad,"marginTop")+SinaEditor.util.dom.styleInteger(this.enbad,"marginBottom")+SinaEditor.util.dom.styleInteger(this.enbad,"borderTopWidth")+SinaEditor.util.dom.styleInteger(this.enbad,"borderBottomWidth");this.enbad.style.top=b.y-c+"px";return this},hiddenBubble:function(){this.enbad.style.display="none",this.enbad.innerHTML="";return this},id:function(a){return this.enbad.ownerDocument.getElementById(a)}}),SinaEditor.$abstract||(SinaEditor.$abstract={}),SinaEditor.$abstract.$BaseButton=function(a,b){this.option=a,this._customSetStatus=a.setState}.$define({eventInit:function(a,b){var c=this,d=a.editorChangeType||"default",e=0;a.init&&a.init.call(this);if(a.events)for(e=0;a.events[e];e++)SinaEditor.ev.add(this.$,a.events[e].name,a.events[e].callback);if(a.mouseoverClass){var f=this;SinaEditor.ev.add(this.$,"mouseover",function(){if(f._state!=SinaEditor.BUTTONSTATE.CLICKED){if(f._state==SinaEditor.BUTTONSTATE.DISABLED)return;f.$.className=f.option.mouseoverClass,f.option.mouseover&&f.option.mouseover(f.$)}}),SinaEditor.ev.add(this.$,"mouseout",function(){f.setState(f._state)})}a.unselected||(SinaEditor.env.$GENKO?this.$.style.MozUserSelect="none":SinaEditor.env.$WEBKIT?this.$.style.WebkitUserSelect="none":this.$.setAttribute("unselectable","on")),this.setState(a.state||SinaEditor.BUTTONSTATE.NORMAL),SinaEditor.ev.add(b,"editorStateChange",function(){SinaEditor.BUTTON[d].call(this,c)})},setState:function(a){this._state=a,this._customSetStatus&&this._customSetStatus.apply(this,arguments);var b=this.option;if(!b.noEvent){var c,d;for(d in SinaEditor.BUTTONSTATE)if(SinaEditor.BUTTONSTATE[d]==a){c=d.toLowerCase(),this.$.className=b[c+"Class"],b[c]&&b[c](this.$);break}}},getState:function(){return this._state}}),SinaEditor.$abstract||(SinaEditor.$abstract={}),SinaEditor.$abstract.Storage=function(){var a={},b=function(){},c=function(){},d=function(){},e=function(){},f=function(){},g=function(){},h=window.localStorage||window.globalStorage&&globalStorage[location.host];h?(a.setItem=function(a,b){try{h.setItem(a,SinaEditor.util.o2s(b));return!0}catch(c){return!1}},a.length=function(){return h.length},a.key=function(a){var b=h.key(a);return b?SinaEditor.util.s2o(b):b},a.getItem=function(a){var b=h.getItem(a);return b?SinaEditor.util.s2o(b):b},a.removeItem=function(a){h.removeItem(a)},a.clear=function(){if(h.clear)h.clear();else while(h.length)a.removeItem(a.key(0))}):(h=document.createElement("div"),h.addBehavior("#default#userData"),document.body?document.body.appendChild(h):document.getElementsByTagName("head")[0].appendChild(h),h.load("SinaEditor"),a.setItem=function(a,b){try{var c=!1,d=SinaEditor.util.s2o(h.getAttribute("saveObj"))||[],e;for(e=0;d[e];e++)d[e][a]&&(d[e][a]=b,c=!0);if(!c){var f={};f[a]=b,d.push(f)}h.setAttribute("saveObj",SinaEditor.util.o2s(d)),h.save("SinaEditor");return!0}catch(g){return!1}},a.length=function(){var a=SinaEditor.util.s2o(h.getAttribute("saveObj"))||[];return a.length},a.key=function(a){var b=SinaEditor.util.s2o(h.getAttribute("saveObj"))||[];if(b[a]){var c;for(c in b[a])return c}return null},a.getItem=function(a){var b=SinaEditor.util.s2o(h.getAttribute("saveObj"))||[],c;for(c=0;b[c];c++)if(b[c][a])return b[c][a];return null},a.removeItem=function(a){var b=SinaEditor.util.s2o(h.getAttribute("saveObj"))||[],c;for(c=0;b[c];c++)if(b[c][a]){b.splice(c,1),h.setAttribute("saveObj",SinaEditor.util.o2s(b)),h.save("SinaEditor");return}},a.clear=function(){h.setAttribute("saveObj",SinaEditor.util.o2s([])),h.save("SinaEditor")});return a}(),SinaEditor.$abstract||(SinaEditor.$abstract={}),SinaEditor.$abstract.Template=function(a){this.tmpl=a,this.pattern=/(#\{([^\}]+)(?=\})})/g},SinaEditor.$abstract.Template.prototype={evaluate:function(a){return this.tmpl.replace(this.pattern,function(b,c,d){return a[d]||""})},evaluateMulti:function(a,b){var c=[],d=this;this.__foreach(a,function(e,f){f=b?a.length-f:f,c[f]=d.evaluate(e)});return c.join("")},__foreach:function(a,b){if(a===null&&a.constructor!==Array)return[];var c=0,d=a.length,e=[];while(c<d){var f=b(a[c],c);f!==null&&(e[e.length]=f),c++}return e}},SinaEditor.$abstract||(SinaEditor.$abstract={}),SinaEditor.$abstract.BaseBubbleImpl=function(a){a&&SinaEditor.util.dom.addStyles(a),this.enbad.className=SinaEditor.CONF.bubbleClassName}.$extends(SinaEditor.$abstract.$BaseBubble).$define({showBubble:function(a,b){this.enbad.style.display="none",this.constructor.$super.showBubble.call(this,a,b),this.enbad.style.display="";return this},hiddenBubble:function(){this.constructor.$super.hiddenBubble.call(this);return this},id:function(a){return this.constructor.$super.id.call(this,a)}}),SinaEditor.baseBubble=new SinaEditor.$abstract.BaseBubbleImpl(SinaEditor.CONF.bubbleStyles),function(){var a={},b={};SinaEditor.$abstract.BaseBubblePlugin=function(c){a[c.tagName.toUpperCase()]=c.showBubble;return function(d){var e=this;if(b[e.option.id])return{initialize:function(){},events:[]};b[e.option.id]=1;return{initialize:function(){c.applyStyles&&SinaEditor.util.dom.addStyles(c.applyStyles)},events:[{element:e.entyDoc,events:{mouseup:function(b){b=SinaEditor.ev.fixEvent(b);var c=b.target;c.nodeType==3&&(c=c.parentNode);while(c&&c.tagName){if(a[c.tagName.toUpperCase()]){c.getAttribute("_se_flash")?a.FLASH(c,e):a[c.tagName.toUpperCase()](c,e);return}c=c.parentNode}SinaEditor.baseBubble.hiddenBubble()},keydown:function(){SinaEditor.baseBubble.hiddenBubble()}}},{element:e.entyWin,events:{scroll:function(a){SinaEditor.baseBubble.hiddenBubble()}}},{element:e,events:{editorStateChange:function(){this.getState()!=SinaEditor.STATE.EDITING&&SinaEditor.baseBubble.hiddenBubble()}}}]}}}}(),SinaEditor.$abstract||(SinaEditor.$abstract={}),SinaEditor.$abstract.baseEditor=function(a){this._state=SinaEditor.STATE.CREATING,this.option=a||{},this.option.eventBlackList=this.option.eventBlackList||"",this._jobTable=[],this._jobTableIndex={},this.enty=null,this.entyWin=null,this.entyDoc=null,this.entyBody=null,this.entyArea=null,this.hasAddEvent=!1,this.btns={},this.panels={},this._={},this.errorMsg=[],this.operation={},this.operateState={}}.$define({error:function(a){console.error(a),this.errorMsg.push(a)},add:function(a){this._jobTable.push(a)},start:function(){this.option.onStart&&this.option.onStart(),this.queue(this._jobTable)},queue:function(a,b){var c=this,d=a.length,e=0;c.callPlugin(a[e]);var f=window.setInterval(function(){e++;if(e>=d)clearInterval(f),f=null,SinaEditor.ev.fire(c,"editorOnladed");else if(c.entyWin){if(!c.hasAddEvent){c.hasAddEvent=!0;var b=null;for(b in SinaEditor.ev.customEvent)c.option.eventBlackList.indexOf(b)<0?SinaEditor.ev.$regEvent(b,c):console.log(c.option.id+"在黑名单中："+b)}c.callPlugin(a[e]),c.setState(SinaEditor.STATE.CREATED),c.setState(SinaEditor.STATE.EDITING)}else console.log("等一下"),e--},10)},callPlugin:function(a){var b=function(){return(new Date).valueOf()},c=SinaEditor.plugins.get(a.name);if(!c)console.log(a),console.log("---------------------------plugin not found:");else{var d=c.call(this,a.args||{})||{};console.log(this.option.id+"添加job:"+a.name);var e=d.initialize,f=d.events;if(typeof d=="undefined"){this.error("<b>Job["+a.name+"] is undefiend!!!</b>");return}var g=!0,h=b();try{if(f){var i=0;for(i=0;f[i];i++){var j=f[i],k=j.element,l=j.events,m=null;k||console.error("!!!!!+"+m+"+绑定失败...");for(m in l)console.log(k+"绑定"+m),SinaEditor.ev.add(k,m,l[m],{srcEditor:this})}}e&&e.call(this)}catch(n){this.error("<b>Job["+a.name+"] failed!!!</b>"+n.message+""),g=!1;throw n}finally{if(g)var o=b()}}},focus:function(){this.entyWin.focus()},setState:function(a){this._state=a,SinaEditor.ev.fire(this,"editorStateChange")},getState:function(){return this._state}}),SinaEditor.createEditor=function(conf){var job=new(eval("("+conf.editorName+")"))(conf),pName=conf.plugns,i;job.add(conf.initType),conf.filter&&job.add(conf.filter);for(i=0;pName[i];i++)job.add(pName[i]);job.start();return job},SinaEditor.plugins||(SinaEditor.plugins={},SinaEditor.plugins.add=function(a,b){this._pluginObj||(this._pluginObj={}),this._pluginObj[a]=b},SinaEditor.plugins.get=function(a){return this._pluginObj[a]}),SinaEditor.$abstract||(SinaEditor.$abstract={}),SinaEditor.$abstract.BtnBubble=function(){this.isHidden=!0}.$extends(SinaEditor.$abstract.$BaseBubble).$define({showBubble:function(a,b){b.className&&(this.enbad.className=b.className),this.enbad.style.display="none",this.constructor.$super.showBubble.call(this,a,b),this.enbad.style.display="",SinaEditor.ev.add(document,"mouseup",this._handleClick),this.isHidden=!1;return this},hiddenBubble:function(){this.constructor.$super.hiddenBubble.call(this),SinaEditor.ev.remove(document,"mouseup",this._handleClick),this.isHidden=!0;return this},_handleClick:function(a){a=SinaEditor.ev.fixEvent(a);var b=a.target;SinaEditor.util.dom.containsNode(SinaEditor.btnBubble.enbad,b)||SinaEditor.btnBubble.isHidden||SinaEditor.btnBubble.hiddenBubble()},id:function(a){return this.enbad.ownerDocument.getElementById(a)}}),SinaEditor.btnBubble=new SinaEditor.$abstract.BtnBubble,SinaEditor.$abstract||(SinaEditor.$abstract={}),SinaEditor.$abstract.ButtonFactory=function(){this.buttonObjs={}}.$define({createButton:function(a,b){this.buttonObjs[b.option.id]||(this.buttonObjs[b.option.id]=[]);var c=null;switch(a.btnType||"div"){case"div":c=new SinaEditor.$abstract.divButton(a,b);break;case"custom":c=new SinaEditor.$abstract.customButton(a,b)}c.noAppend||this._addBtn(c,a,b);return c},_addBtn:function(a,b,c){var d=c.option.id+"_"+(b.group||"g"+(new Date).getTime()),e=!1,f=this.buttonObjs[c.option.id],g;for(g=0;f[g];g++)f[g][d]&&(e=!0,f[g][d].push(a));if(!e){var h={};h[d]=[a],this.buttonObjs[c.option.id].push(h)}var i=this;if(c.getState()<=SinaEditor.STATE.CREATED)SinaEditor.ev.add(c,"editorOnladed",function(){var a=i.buttonObjs[this.option.id],b,c,e,f;for(e=0;a[e];e++){b=a[e];var g=SinaEditor.util.dom.createDom("div",{properties:{className:"se_ico_group",id:d}});for(id in b)for(f=0;b[id][f];f++)g.appendChild(b[id][f].$);document.getElementById(this.option.toolBase).appendChild(g)}},{once:!0});else{var j=document.getElementById(d)||SinaEditor.util.dom.createDom("div",{properties:{className:"se_ico_group",id:d}});j.appendChild(a.$),document.getElementById(c.option.toolBase).appendChild(j)}}}),SinaEditor.ButtonFactory=new SinaEditor.$abstract.ButtonFactory,SinaEditor.$abstract||(SinaEditor.$abstract={}),SinaEditor.$abstract.customButton=function(a,b){this.$=this.option.entyBtn,this.noAppend=!0,a.noEvent||this.eventInit(a,b)}.$extends(SinaEditor.$abstract.$BaseButton).$define({}),SinaEditor.$abstract||(SinaEditor.$abstract={}),SinaEditor.$abstract.divButton=function(a,b){a.attributes=a.attributes||{},a.properties=a.properties||{},a.attributes.id||(a.attributes.id="b_"+(new Date).getTime()),a.properties.innerHTML||(a.properties.innerHTML="&nbsp;"),this.$=SinaEditor.util.dom.createDom("div",{attributes:a.attributes,properties:a.properties}),a.title&&(this.$.title=a.title),a.noEvent||this.eventInit(a,b),this.noAppend=!1}.$extends(SinaEditor.$abstract.$BaseButton).$define({}),SinaEditor.$abstract||(SinaEditor.$abstract={}),SinaEditor.$abstract.redoManager=function(){this.maxLan=SinaEditor.CONF.redoConf||100,this.points={},this.cache={}}.$define({addEditor:function(a){SinaEditor.ev.remove(a,"redoAndUndoChanged"),SinaEditor.ev.$regEvent("redoAndUndoChanged",a),this.points[a.option.id]=0,this.cache[a.option.id]=[{html:a.entyBody.innerHTML}],this.save(a)},save:function(a){console.log("保存:"+a.option.id);var b=this.cache[a.option.id].length,c=this.points[a.option.id],d=this.cache[a.option.id][c].html,e=a.entyBody.innerHTML,f,g;SinaEditor.env.$IE||(f=SinaEditor.range.getCurrentRanges(a.entyWin),g=this._converToBookMark(f)),d!==e?(console.log("数据不一样，保存"),c+1!=b&&(console.log("清除历史分支"),this.cache[a.option.id].splice(c+1,b),b=this.cache[a.option.id].length),b==this.maxLan&&(console.log("到达最后记录点"),this.cache[a.option.id].shift(),b--),this.cache[a.option.id].push({html:e,ranges:g}),this.points[a.option.id]=b):(console.log("更新当前range"),this.cache[a.option.id][c].ranges=g),this._fireEvent(a)},redo:function(a){console.log("重做:"+a.option.id);var b=this.points[a.option.id],c=this.cache[a.option.id].length;if(b+1==c)console.log("已经重做到尽头");else{this.points[a.option.id]=++b;var d=this.cache[a.option.id][b],e=this;setTimeout(function(){a.entyBody.innerHTML=d.html,SinaEditor.env.$IE||SinaEditor.range.applyRanges(a.entyWin,e._converToRange(a.entyDoc,d.ranges)),a.focus(),e._fireEvent(a)},0)}},undo:function(a){console.log("回退:"+a.option.id);var b=this.points[a.option.id];if(b<=0)console.log("已经回退到尽头");else{this.points[a.option.id]=--b;var c=this.cache[a.option.id][b],d=this;setTimeout(function(){a.entyBody.innerHTML=c.html,SinaEditor.env.$IE||SinaEditor.range.applyRanges(a.entyWin,d._converToRange(a.entyDoc,c.ranges)),a.focus(),d._fireEvent(a)},0)}},_converToBookMark:function(a){var b=[],c;for(c=0;a[c];c++){var d={};d.startOffset=a[c].startOffset,d.endOffset=a[c].endOffset,d.start=this._setPath(a[c].startContainer),d.end=this._setPath(a[c].endContainer),b.push(d)}return b},_converToRange:function(a,b){var c=0,d=[];while(b[c]){var e=b[c],f=a.createRange();console.log(this._getPath(a.body,e.start)),console.log(e.startOffset),f.setStart(this._getPath(a.body,e.start),e.startOffset),f.setEnd(this._getPath(a.body,e.end),e.endOffset),d.push(f),c++}return d},_setPath:function(a){var b=[],c=a,d=a.parentNode;while(d&&d.nodeType!==SinaEditor.NODETYPE.HTMLELEMENT){var e=d.childNodes,f;for(f=0;e[f];f++)if(e[f]==c){b.push(f);break}c=d,d=d.parentNode}return b},_getPath:function(a,b){var c=a,d=b.length-1;while(d>=0)c=c.childNodes[b[d]],d--;return c},_fireEvent:function(a){var b=this.points[a.option.id];a._.hasRedo=b==this.cache[a.option.id].length-1?!1:!0,a._.hasUndo=b===0?!1:!0,SinaEditor.ev.fire(a,"redoAndUndoChanged")}}),SinaEditor.redoManager=new SinaEditor.$abstract.redoManager,SinaEditor.plugins.add("addContent",function(a){var b=this;b.operation.addNode=function(a,d){b.focus(),b.operation.save(b);var e=SinaEditor.range.getCurrentRanges(b.entyWin)[0];e.collapsed||e.deleteContents(),e.insertNode(a),d||c(a,e),b.operation.save(b)},b.operation.addContent=function(a,d){b.focus(),b.operation.save(b);var e=SinaEditor.range.getCurrentRanges(b.entyWin)[0];e.collapsed||e.deleteContents();var f=b.entyDoc.createTextNode(a);e.insertNode(f),d||c(f,e),b.operation.save(b)};var c=function(a,c){c.selectNode(a),c.collapse(!1),SinaEditor.range.applyRanges(b.entyWin,c),b.focus()}}),SinaEditor.plugins.add("backcolor",function(a){var b=this;b.btns.backcolor=null,b.panels.backcolor=null,a.customerPanel||b.callPlugin({name:"backcolorPanel",args:a}),a.customerBtn||b.callPlugin({name:"backcolorBtn",args:a}),SinaEditor.range.regQueryCommandState("backcolor",function(a){return SinaEditor.util.dom.getStyle(a,"backgroundColor")}),b.operation.backcolor=function(a){b.operation.save(b),console.log("背景颜色修改"),SinaEditor.range.applyStyle(b,{useTagName:"span",style:"backgroundColor",value:a}),b.btns.backcolor.setState(SinaEditor.BUTTONSTATE.NORMAL,a),b.operation.save(b)}}),SinaEditor.plugins.add("backcolorBtn",function(a){var b=this,c={title:"背景颜色",normalClass:"ico_hilitecolor_1",disabledClass:"ico_hilitecolor_4",clickedClass:"ico_hilitecolor_3",mouseoverClass:"ico_hilitecolor_2",state:SinaEditor.BUTTONSTATE.DISABLED,group:"common",setState:function(a,b){switch(a){case SinaEditor.BUTTONSTATE.DISABLED:this.$.style.backgroundColor="#FFFFFF";break;default:this.$.style.backgroundColor=b}}};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.backcolor=d;return{events:[{element:d.$,events:{click:function(){if(b.btns.backcolor.getState()===SinaEditor.BUTTONSTATE.DISABLED)return!1;b.panels.backcolor.show(this);return!1}}},{element:b,events:{editorSelectionChange:function(a,c,d){var e=SinaEditor.range.queryCommandState(this.entyDoc,"backColor");e==="transparent"&&(e="#FFFFFF"),b.btns.backcolor.setState(SinaEditor.BUTTONSTATE.NORMAL,e)}}}]}}),SinaEditor.plugins.add("backcolorPanel",function(a){var b=this,c=SinaEditor.util.dom.createDom("div",{properties:{className:"se_forecolor_bubble"}});b.panels.backcolor=function(){var d=a.colors||SinaEditor.TOOLCONF.COLOR;c.style.display="none",document.body.appendChild(c);var e=[],f;for(f in d)e.push('<span onmouseover="this.className=\'color_focus\'" onmouseout="this.className=\'\'"><span class="j_single_color" title="'),e.push(d[f]),e.push('" style="background-color:#'),e.push(f),e.push(';"></span></span>');c.innerHTML=e.join("");return{show:function(a){var d=SinaEditor.util.dom.getXY(a);c.style.display="",c.style.top=d[1]+b.btns.backcolor.$.offsetHeight+"px",c.style.left=d[0]+"px"},hidden:function(){c.style.display="none"}}}();return{events:[{element:b,events:{editorSelectionChange:function(){b.panels.backcolor.hidden()}}},{element:c,events:{click:function(a){SinaEditor.ev.stopEvent(a),b.focus();var c=a.target;c.className==="j_single_color"&&(b.operation.backcolor(SinaEditor.util.dom.getStyle(c,"backgroundColor")),b.panels.backcolor.hidden());return!1}}},{element:document,events:{click:function(a){var d=a.target;if(SinaEditor.util.dom.containsNode(b.btns.backcolor.$,d))return!1;SinaEditor.util.dom.containsNode(c,d)||b.panels.backcolor.hidden();return!1}}}]}}),SinaEditor.plugins.add("bold",function(a){var b=this;a.customerBtn||b.callPlugin({name:"boldBtn",args:a});var c=b.btns.bold;b.operation.bold=function(a){var d=SinaEditor.range.getCurrentRanges(b.entyWin);d=d[0];if(!!d){b.operation.save(b);var e=b.operateState.bold;e?(console.log("执行去加粗操作"),SinaEditor.range.removeStyle(b,{useTagName:["strong","b"]}),c.setState(SinaEditor.BUTTONSTATE.NORMAL)):(console.log("执行加粗操作"),SinaEditor.range.applyStyle(b,{useTagName:"strong"}),c.setState(SinaEditor.BUTTONSTATE.CLICKED)),b.operateState.bold=!e,b.operation.save(b)}};return{events:[{element:b,events:{editorSelectionChange:function(a,b,d){var e=SinaEditor.range.queryCommandState(this.entyDoc,"bold");e?c.setState(SinaEditor.BUTTONSTATE.CLICKED):c.setState(SinaEditor.BUTTONSTATE.NORMAL),this.operateState.bold=e},ctrlb:function(){b.operation.bold(this)}}}]}}),SinaEditor.plugins.add("boldBtn",function(a){var b=this,c={title:"加粗",normalClass:"ico_bold_1",disabledClass:"ico_bold_4",clickedClass:"ico_bold_3",mouseoverClass:"ico_bold_2",state:SinaEditor.BUTTONSTATE.DISABLED,group:"common"};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.bold=d;return{events:[{element:d.$,events:{click:function(a){SinaEditor.ev.stopEvent(a),b.operation.bold(b);return!1}}}]}}),SinaEditor.plugins.add("faceUI",function(a){var b=this;a.customerBtn||b.callPlugin({name:"faceUIBtn",args:a}),a.customerPanel||b.callPlugin({name:"faceUIPanel",args:a}),b.operation.addFace=function(a){if(!!a){b.operation.save(b);var c=SinaEditor.util.dom.createDom("img",{ownerDocument:b.entyDoc,attributes:{_se_type:"face"},properties:{src:a}});b.operation.addNode(c),b.operation.save(b)}}}),SinaEditor.plugins.add("faceUIBtn",function(a){var b=this,c={title:"表情",normalClass:"ico_face_1",disabledClass:"ico_face_4",clickedClass:"ico_face_3",mouseoverClass:"ico_face_2",state:SinaEditor.BUTTONSTATE.NORMAL,group:"richdata"};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.faceUI=d;return{events:[{element:d.$,events:{click:function(){var a=b.panels.faceUI;if(d.getState()===SinaEditor.BUTTONSTATE.DISABLED)return!1;var c=SinaEditor.util.dom.getXY(d.$);a.setPosition({x:c[0],y:c[1]+d.$.offsetHeight}),a.show()}}}]}}),SinaEditor.plugins.add("faceUIPanel",function(a){var b=this,c=new SinaEditor._.Panel;c.setTemplate(SinaEditor.TOOLCONF.faceTemplate);var d=c.nodes.panel,e=a.faceSrc||SinaEditor.TOOLCONF.faceSrc,f=[],g,h;for(g=0;e[g];g++){f.push("<img ");for(h in e[g])f.push(h),f.push('="'),f.push(e[g][h]),f.push('"');f.push('" onmouseout="this.className=\'\'" onmouseover="this.className=\'face_focus\'" '),f.push("/>")}d.innerHTML=f.join(""),b.panels.faceUI=c;return{events:[{element:b,events:{editorSelectionChange:function(){c.hidden()}}},{element:d,events:{click:function(a){var d=a.target;d.tagName.toUpperCase()=="IMG"&&(b.operation.addFace(d.src),c.hidden())}}},{element:document,events:{click:function(a){var e=a.target;SinaEditor.util.dom.containsNode(b.btns.faceUI.$,e)||SinaEditor.util.dom.containsNode(d,e)||c.hidden()}}}]}}),SinaEditor.plugins.add("flashBubble",function(){return SinaEditor.$abstract.BaseBubblePlugin({tagName:"FLASH",applyStyles:SinaEditor.CONF.aBubbleStyles,showBubble:function(a,b){var c=(new Date).getTime(),d,e,f="f_se_b_"+c,g="f_d_b_"+c,h="f_s_b_"+c,i="f_c_b_"+c;e={seeid:f,deleteid:g,showflash:h,closeid:i};var j=a.href;d=new SinaEditor.$abstract.Template(SinaEditor.CONF.flashBubbleTemplete);var k=SinaEditor.util.dom.getXY(a,!0),l=SinaEditor.util.dom.getXY(b.enty);l[1]>k[1]&&(k[1]=l[1]);var m=SinaEditor.baseBubble.showBubble(d.evaluate(e),{x:k[0],y:k[1]});m.id(f).onclick=function(){var b=m.id(h);m.id(f).style.display="none",b.innerHTML=decodeURIComponent(a.getAttribute("_se_flash"));if(SinaEditor.env.$CHROME){var c=b.getElementsByTagName("embed")[0];c.setAttribute("wmode","transparent"),b.innerHTML=SinaEditor.util.dom.outerHTML(c)}b.style.display=""},m.id(i).onclick=function(){SinaEditor.baseBubble.hiddenBubble(),b.focus()},m.id(g).onclick=function(){b.operation.save(b);var c=a;SinaEditor.range.setStartBefore(b.entyWin,a),a.parentNode.removeChild(a),SinaEditor.baseBubble.hiddenBubble(),b.focus(),b.operation.save(b)}}})}()),SinaEditor.plugins.add("flashUI",function(a){var b=this;a.customerBtn||b.callPlugin({name:"flashUIBtn",args:a}),a.customerPanel||b.callPlugin({name:"flashUIPanel",args:a}),b.operation.insertFlash=function(a,c){typeof a=="string"&&(a=SinaEditor.util.dom.createDomFromHTML(a,b.entyDoc));var d=SinaEditor.util.dom.createDomFromHTML('<img src="'+SinaEditor.CONF.transparentIMG+'" _se_flash="'+encodeURIComponent(SinaEditor.util.dom.outerHTML(a))+'" width="'+(a.width||480)+'" height="'+(a.height||370)+'" style="background:url(\''+SinaEditor.CONF.fakeFLASH+"') no-repeat scroll center center transparent;border:1px solid #A9A9A9;\" >",b.entyDoc);b.operation.addNode(d,c)}}),SinaEditor.plugins.add("flashUIBtn",function(a){var b=this,c={title:"插入flash",normalClass:"ico_video_1",disabledClass:"ico_video_4",clickedClass:"ico_video_3",mouseoverClass:"ico_video_2",state:SinaEditor.BUTTONSTATE.DISABLED,group:"richdata"};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.flashUI=d;return{events:[{element:d.$,events:{click:function(){if(d.getState()===SinaEditor.BUTTONSTATE.DISABLED)return!1;b.panels.flashUI.show();return!1}}}]}}),SinaEditor.plugins.add("flashUIPanel",function(a){var b=this,c=SinaEditor.winDialog.create({title:"添加flash",content:SinaEditor.TOOLCONF.flashTemplate,funcClose:function(){h()}}),d=c.nodes.flashSrc,e=c.nodes.ok,f=c.nodes.cancel,g=c.nodes.flashErrTip,h=function(){d.value="",g.style.display="none"};b.panels.flashUI=c;return{events:[{element:f,events:{click:function(){h(),c.hidden()}}},{element:e,events:{click:function(){g.style.display="none";var a=SinaEditor.util.trim(d.value);a?(b.operation.insertFlash(a),h(),c.hidden()):g.style.display=""}}}]}}),SinaEditor.plugins.add("fontSize",function(a){var b=this;SinaEditor.range.regQueryCommandState("fontsize",function(a){return SinaEditor.util.dom.getStyle(a,"fontSize")}),a.customerBtn||b.callPlugin({name:"fontSizeBtn",args:a}),a.customerBtn||b.callPlugin({name:"fontSizePanel",args:a});var c=b.btns.fontSize;b.operation.setFontSize=function(a){b.focus(),b.operation.save(b),SinaEditor.range.applyStyle(b,{useTagName:"span",style:"fontSize",value:a}),b.operation.save(b)}}),SinaEditor.plugins.add("fontSizeBtn",function(a){var b=this,c={title:"文字大小",normalClass:"ico_fontsize_1",properties:{innerHTML:"<span>"+SinaEditor.TOOLCONF.FONTSIZEDEF+"</span>"},disabledClass:"ico_fontsize_4",clickedClass:"ico_fontsize_3",mouseoverClass:"ico_fontsize_2",state:SinaEditor.BUTTONSTATE.NORMAL,group:"common"};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.fontSize=d}),SinaEditor.plugins.add("fontSizePanel",function(a){var b=this,c=b.btns.fontSize,d=a.conf||SinaEditor.TOOLCONF.FONTSIZECONF,e=function(a){var b=d,c=['<div class="fontItemTitle">字号</div>'],e,f,g;for(g=0;b[g];g++)e=b[g].html,f=b[g].style||e,c.push('<div class="fontItem" style="font-size:'),c.push(f),c.push('">'),c.push(e),c.push("</div>");return c.join("")},f=function(a){var d,e;for(d=0;a[d];d++)e=a[d].className,e&&e=="fontItem"&&(a[d].onclick=function(a){a=a||window.event;var d=SinaEditor.ev.fixEvent(a).target,e=d.style.fontSize;c.$.innerHTML="<span>"+d.innerHTML+"</span>",b.operation.setFontSize(e),SinaEditor.btnBubble.hiddenBubble();return!1})};return{events:[{element:b,events:{editorSelectionChange:function(){SinaEditor.btnBubble.hiddenBubble()},editorSelectionChange:function(a,b,e){var f=SinaEditor.range.queryCommandState(this.entyDoc,"fontsize"),g=d;console.log(f);var h="<span>"+SinaEditor.TOOLCONF.FONTSIZEDEF+"</span>",i,j;for(j=0;g[j];j++){i=g[j].style||g[j].html;if(f.indexOf(i)!=-1){h="<span>"+g[j].html+"</span>";break}}c.$.innerHTML=h}}},{element:c.$,events:{click:function(){if(b.getState()==SinaEditor.STATE.EDITING){var a=SinaEditor.util.dom.getXY(c.$),d=SinaEditor.util.dom.createDom("div");d.innerHTML=e(b.option.id),f(d.childNodes),SinaEditor.btnBubble.showBubble(d,{x:a[0],y:a[1]+c.$.offsetHeight+SinaEditor.util.dom.styleInteger(c.$,"paddingTop")+SinaEditor.util.dom.styleInteger(c.$,"marginTop"),className:"se_fontfamily_bubble"});return!1}}}}]}}),SinaEditor.plugins.add("fontFamily",
function(a){var b=this,c=null;SinaEditor._fontConf||(SinaEditor._fontConf={}),a.customerBtn||b.callPlugin({name:"fontFamilyBtn",args:a}),a.customerPanel||b.callPlugin({name:"fontFamilyPanel",args:a}),b.operation.setFontFamily=function(a){b.operation.save(b),SinaEditor.range.applyStyle(b,{useTagName:"span",style:"fontFamily",value:a}),b.operation.save(b)}}),SinaEditor.plugins.add("fontFamilyBtn",function(a){var b=this,c=a.conf||SinaEditor.TOOLCONF.FONTFAMILYCONF,d={title:"字体",normalClass:"ico_family_1",properties:{innerHTML:"<span>"+SinaEditor.TOOLCONF.FONTFAMILYDEF+"</span>"},disabledClass:"ico_family_4",clickedClass:"ico_family_3",mouseoverClass:"ico_family_2",state:SinaEditor.BUTTONSTATE.NORMAL,group:"common"};d=SinaEditor.util.mix(d,a.btnConf);var e=SinaEditor.ButtonFactory.createButton(d,b);b.btns.fontFamily=e;var f=function(a){var b=['<div class="fontItemTitle">字体</div>'],d,e,f;for(f=0;c[f];f++)d=c[f].html,e=c[f].style||d,b.push('<div class="fontItem" style="font-family:'),b.push(e),b.push('">'),b.push(d),b.push("</div>");return b.join("")},g=function(a){var c;for(c=0;a[c];c++){var d=a[c].className;d&&d=="fontItem"&&(a[c].onclick=function(a){b.focus(),a=a||window.event;var c=SinaEditor.ev.fixEvent(a).target,d=c.style.fontFamily;e.$.innerHTML='<span style="font-family:'+d+'">'+c.innerHTML+"</span>",b.operation.setFontFamily(d),SinaEditor.btnBubble.hiddenBubble();return!1})}};return{events:[{element:e.$,events:{click:function(){if(b.getState()==SinaEditor.STATE.EDITING){var a=SinaEditor.util.dom.getXY(e.$),c=SinaEditor.util.dom.createDom("div");c.innerHTML=f(b.option.id),g(c.childNodes),SinaEditor.btnBubble.showBubble(c,{x:a[0],y:a[1]+e.$.offsetHeight+SinaEditor.util.dom.styleInteger(e.$,"paddingTop")+SinaEditor.util.dom.styleInteger(e.$,"marginTop"),className:"se_fontfamily_bubble"});return!1}}}},{element:b,events:{editorSelectionChange:function(a,b,d){var f=SinaEditor.util.dom.getStyle(d,"fontFamily"),g=c,h="<span>"+SinaEditor.TOOLCONF.FONTFAMILYDEF+"</span>",i,j;for(j=0;g[j];j++){i=g[j].style||g[j].html;if(f.indexOf(i)!=-1){h='<span style="font-family:'+i+'">'+g[j].html+"</span>";break}}e.$.innerHTML=h}}}]}}),SinaEditor.plugins.add("fontFamilyPanel",function(a){var b=this,c=b.btns.fontFamily,d=a.fontConf||SinaEditor.TOOLCONF.FONTFAMILYCONF,e=function(a){var d;for(d=0;a[d];d++){var e=a[d].className;e&&e=="fontItem"&&(a[d].onclick=function(a){a=a||window.event;var d=SinaEditor.ev.fixEvent(a).target,e=d.style.fontFamily;c.$.innerHTML='<span style="font-family:'+e+'">'+d.innerHTML+"</span>",b.operation.setFontFamily(e),SinaEditor.btnBubble.hiddenBubble();return!1})}};return{events:[{element:b,events:{editorSelectionChange:function(){SinaEditor.btnBubble.hiddenBubble()}}}]}}),SinaEditor.plugins.add("forecolor",function(a){var b=this;a.customerPanel||b.callPlugin({name:"forecolorPanel",args:a}),a.customerBtn||b.callPlugin({name:"forecolorBtn",args:a});var c=b.btns.forecolor,d=b.panels.forecolor;SinaEditor.range.regQueryCommandState("forecolor",function(a){console.log(SinaEditor.util.dom.getStyle(a,"color")||"#CCC");return SinaEditor.util.dom.getStyle(a,"color")}),b.operation.forecolor=function(a){b.focus(),b.operation.save(b),console.log("文字颜色修改"),SinaEditor.range.applyStyle(b,{useTagName:"span",style:"color",value:a}),c.setState(SinaEditor.BUTTONSTATE.NORMAL,a),b.operation.save(b)}}),SinaEditor.plugins.add("forecolorBtn",function(a){var b=this,c={title:"文字颜色",normalClass:"ico_forecolor_1",disabledClass:"ico_forecolor_4",clickedClass:"ico_forecolor_3",mouseoverClass:"ico_forecolor_2",state:SinaEditor.BUTTONSTATE.DISABLED,group:"common",setState:function(a,b){switch(a){case SinaEditor.BUTTONSTATE.DISABLED:this.$.style.backgroundColor="#000000";break;default:this.$.style.backgroundColor=b}}};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.forecolor=d;return{events:[{element:b,events:{editorSelectionChange:function(a,b,c){var e=SinaEditor.range.queryCommandState(this.entyDoc,"forecolor");e||(e="#000000"),d.setState(SinaEditor.BUTTONSTATE.NORMAL,e)}}},{element:d.$,events:{click:function(a,c,d){if(b.btns.backcolor.getState()===SinaEditor.BUTTONSTATE.DISABLED)return!1;b.panels.forecolor.show(this);return!1}}}]}}),SinaEditor.plugins.add("forecolorPanel",function(a){var b=this,c=SinaEditor.util.dom.createDom("div",{properties:{className:"se_forecolor_bubble"}}),d=function(){var d=a.colors||SinaEditor.TOOLCONF.COLOR;c.style.display="none",document.body.appendChild(c);var e=[],f;for(f in d)e.push('<span onmouseover="this.className=\'color_focus\'" onmouseout="this.className=\'\'"><span class="j_single_color" title="'),e.push(d[f]),e.push('" style="background-color:#'),e.push(f),e.push(';"></span></span>');c.innerHTML=e.join("");return{show:function(a){var d=SinaEditor.util.dom.getXY(a);c.style.display="",c.style.top=d[1]+b.btns.forecolor.$.offsetHeight+"px",c.style.left=d[0]+"px"},hidden:function(){c.style.display="none"}}}();b.panels.forecolor=d;return{events:[{element:c,events:{click:function(a){var c=a.target;c.className==="j_single_color"&&(b.operation.forecolor(SinaEditor.util.dom.getStyle(c,"backgroundColor")),d.hidden())}}},{element:document,events:{click:function(a){var e=a.target;SinaEditor.util.dom.containsNode(b.btns.forecolor.$,e)||SinaEditor.util.dom.containsNode(c,e)||d.hidden()}}},{element:b,events:{editorSelectionChange:function(a){d.hidden()}}}]}}),SinaEditor.plugins.add("historyUI",function(a){var b=this,c="";a.customerBtn||b.callPlugin({name:"historyUIBtn",args:a}),a.customerPanel||b.callPlugin({name:"historyUIPanel",args:a});var d=a.id||0,e=SinaEditor.$abstract.Storage;b.operation.saveData=function(){var a=b.entyBody.innerHTML;if(c===a)return!1;var f=e.getItem("SinaEditorData"+d)||[],g=+(new Date);f.unshift(g);if(f.length>SinaEditor.TOOLCONF.historyMax){var h=f.splice(0,SinaEditor.TOOLCONF.historyMax),i;for(i=0;f[i];i++)e.removeItem("data_"+d+"_"+f[i]);f=h}if(e.setItem("data_"+d+"_"+g,encodeURIComponent(a))&&e.setItem("SinaEditorData"+d,f)){c=a,b.panels.historyUI.updataData();return!0}e.removeItem("data_"+d+"_"+f[0]),f.shift(),e.setItem("SinaEditorData"+d,f);return!1},b.operation.loadData=function(a){return a?decodeURIComponent(e.getItem("data_"+d+"_"+a)):e.getItem("SinaEditorData"+d)},b.operation.putData=function(a){var c=this.loadData(a);!c||(c.join&&(c=this.loadData(c[0])),b.entyBody.innerHTML=c,b.operation.clearRU())};var f=function(){},g=function(){};if(!a.closeAutoSave){var h;f=function(){h=setInterval(function(){b.operation.saveData()},6e5)},g=function(){clearInterval(h)}}return{events:[{element:b,events:{editorStateChange:function(){switch(this.getState()){case SinaEditor.STATE.CREATED:b.panels.historyUI.updataData(),b.operation.putData(0),f();break;case SinaEditor.STATE.EDITING:clearInterval(h),f();break;case SinaEditor.STATE.SHOWSOURCE:g()}},ctrls:function(){b.operation.saveData()}}}]}}),SinaEditor.plugins.add("historyUIBtn",function(a){var b=this,c={title:"历史版本",normalClass:"ico_quicksave_1",disabledClass:"ico_quicksave_4",clickedClass:"ico_quicksave_3",mouseoverClass:"ico_quicksave_2",state:SinaEditor.BUTTONSTATE.NORMAL,group:"richdata"};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.historyUI=d;return{events:[{element:d.$,events:{click:function(){if(d.getState()===SinaEditor.BUTTONSTATE.DISABLED)return!1;var a=b.panels.historyUI,c=SinaEditor.util.dom.getXY(d.$);a.setPosition({x:c[0],y:c[1]+d.$.offsetHeight}),a.show()}}}]}}),SinaEditor.plugins.add("historyUIPanel",function(a){var b=this,c=null,d=a.id||0,e=SinaEditor.$abstract.Storage,f=new SinaEditor._.Panel;f.setTemplate(SinaEditor.TOOLCONF.historyTemplate);var g=f.nodes.panel,h=function(a){return a<10?"0"+a:a};b.panels.historyUI=f,b.panels.historyUI.updataData=function(){var a=b.operation.loadData()||[];if(!!a.length){var c=[],d,e;for(e=0;a[e];e++)d=new Date(a[e]),c.push('<div time="'),c.push(a[e]),c.push('" >'),c.push(d.getFullYear()),c.push("-"),c.push(h(d.getMonth()+1)),c.push("-"),c.push(h(d.getDate())),c.push("&nbsp;"),c.push(h(d.getHours())),c.push(":"),c.push(h(d.getMinutes())),c.push(":"),c.push(h(d.getSeconds())),c.push("</div>");g.innerHTML=c.join("")}};return{events:[{element:b,events:{editorSelectionChange:function(){f.hidden()}}},{element:g,events:{click:function(a){var c=a.target,d=c.getAttribute("time");c.tagName.toUpperCase()=="DIV"&&d&&(b.operation.putData(d),f.hidden())}}},{element:document,events:{click:function(a){var c=b.btns.historyUI,d=a.target;d!==c.$&&(SinaEditor.util.dom.containsNode(g,d)||f.hidden())}}}]}}),SinaEditor.plugins.add("imgBubble",function(){return SinaEditor.$abstract.BaseBubblePlugin({tagName:"IMG",applyStyles:SinaEditor.CONF.aBubbleStyles,showBubble:function(a,b){if(!a.getAttribute("_se_type")){var c=(new Date).getTime(),d,e,f="i_m_b_"+c,g="i_d_b_"+c;e={modifyid:f,deleteid:g};var h=a.href;d=new SinaEditor.$abstract.Template(SinaEditor.CONF.imgBubbleTemplete);var i=SinaEditor.util.dom.getXY(a,!0),j=SinaEditor.util.dom.getXY(b.enty,!0);j[1]>i[1]&&(i[1]=j[1]);var k=SinaEditor.baseBubble.showBubble(d.evaluate(e),{x:i[0],y:i[1]});SinaEditor.CONF.imgBubbleModify?k.id(f).onclick=function(){SinaEditor.CONF.imgBubbleModify(a)||SinaEditor.baseBubble.hiddenBubble();return!1}:k.id(f).style.display="none",SinaEditor.CONF.imgBubbleDelete?k.id(g).onclick=function(){SinaEditor.CONF.imgBubbleDelete(a)||SinaEditor.baseBubble.hiddenBubble();return!1}:k.id(g).style.display="none"}}})}()),SinaEditor.plugins.add("imgUI",function(a){var b=this;a.customerBtn||b.callPlugin({name:"imgUIBtn",args:a}),a.customerPanel||b.callPlugin({name:"imgUIPanel",args:a}),SinaEditor.CONF.imgBubbleModify||(SinaEditor.CONF.imgBubbleModify=function(a){var c=b.panels.imgUI;c.fromBubble=!0,c.tmpNode=a,b.panels.imgUI.show()}),SinaEditor.CONF.imgBubbleDelete||(SinaEditor.CONF.imgBubbleDelete=function(a){b.operation.save(b),a.parentNode.removeChild(a),b.operation.save(b),b.focus()})}),SinaEditor.plugins.add("imgUIBtn",function(a){var b=this,c={title:"插入图片",normalClass:"ico_img_1",disabledClass:"ico_img_4",clickedClass:"ico_img_3",mouseoverClass:"ico_img_2",state:SinaEditor.BUTTONSTATE.NORMAL,group:"richdata"};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.imgUI=d;return{events:[{element:d.$,events:{click:function(){if(d.getState()===SinaEditor.BUTTONSTATE.DISABLED)return!1;b.panels.imgUI.show();return!1}}}]}}),SinaEditor.plugins.add("imgUIPanel",function(a){var b=this,c=442,d=630,e=SinaEditor.winDialog.create({title:"添加图片",content:SinaEditor.TOOLCONF.imgTemplate,funcClose:function(){C?K():L()}}),f=e.nodes.useClient,g=e.nodes.clientView,h=e.nodes.clientFile,i=e.nodes.contentLoading,j=e.nodes.cancleClient,k=e.nodes.resultPic,l=e.nodes.addClientPic,m=e.nodes.webContent,n=e.nodes.webUrl,o=e.nodes.clientResult,p=e.nodes.errTips,q=e.nodes.clientIframe,r=e.nodes.resetClient,s=e.nodes.clientUploadDiv,t=e.nodes.clientMoreUp,u=e.nodes.clientForm,v=e.nodes.tabMy,w=e.nodes.tabWeb,x=e.nodes.webAdd,y=e.nodes.webPic,z=y.parentNode,A=e.nodes.webPicLoading,B=e.nodes.clientFileDrag,C=!0,D="http://",E=null,F=D;e.fromBubble=!1,e.tmpNode=null;var G=function(a){C!==!!a&&(a?(K(!0),v.className="cur",m.style.display="none",w.className="",f.style.display=""):(L(!0),v.className="",f.style.display="none",w.className="cur",m.style.display=""),C=!C)},H=function(a){i.style.display="none",g.style.display="none",o.style.display="none",a.style.display=""},I={showErr:function(a,b){p.innerHTML=a,p.style.display="";if(b){var c=this;setTimeout(function(){c.hiddenErr()},b*1e3)}},hiddenErr:function(){p.style.display="none"}},J=function(a){if(!!a.src){a.removeAttribute("width"),a.removeAttribute("height");var b=a.width,e=a.height;if(b<d&&e<c)return;d/c<b/e?a.width=d:a.height=c}},K=function(a){H(g),I.hiddenErr(),a||(e.fromBubble=!1,e.tmpNode=null),k.src=""},L=function(a){F=D,n.value=D,x.style.display="none",z.style.display="none",A.style.display="none",I.hiddenErr(),a||(e.fromBubble=!1,e.tmpNode=null),x.src=""},M=function(a){a=a||"";if(!SinaEditor.TOOLCONF.imgType.test(a)){I.showErr(SinaEditor.TOOLCONF.imgErrTypeMSG,3);return!1}return!0};SinaEditor.ev.add(s,"dragenter",function(a){t.style.display="",s.style.borderStyle="dashed"}),SinaEditor.ev.add(s,"dragover",function(a){SinaEditor.ev.stopEvent(a)}),SinaEditor.ev.add(s,"drop",function(a){SinaEditor.ev.stopEvent(a),s.style.borderStyle="solid",t.style.display="none";var b=a.dataTransfer.files;b.length&&(b=b[0]);if(!!M(b.name)){var c=new FileReader;c.onload=function(a){B.value=a.target.result,u.submit(),H(i),B.value=""},c.readAsDataURL(b)}}),SinaEditor.ev.add(s,"dragleave",function(a){s.style.borderStyle="solid",t.style.display="none"}),b.panels.imgUI=e;return{events:[{element:n,events:{focus:function(){E=setInterval(function(){var a=n.value;if(a!=F){F=a,z.style.display="none",A.style.display="";var b=new Image;b.onload=function(){y.src=b.src,setTimeout(function(){J(y),I.hiddenErr(),A.style.display="none",z.style.display="",x.style.display=""},1)},b.onerror=function(){x.style.display="none",I.showErr("您输入的图片不是正确的地址，请重新输入。"),z.style.display="none",A.style.display="none"},b.src=n.value}},1e3)},blur:function(){clearInterval(E)}}},{element:v,events:{click:function(){G(!0)}}},{element:w,events:{click:function(){G(!1)}}},{element:l,events:{click:function(){if(e.fromBubble)e.tmpNode.src=k.src,e.hidden(),K();else{var a=SinaEditor.util.dom.createDom("img",{ownerDocument:b.entyDoc,properties:{src:k.src}});b.operation.addNode(a,!0),e.hidden(),K()}}}},{element:x,events:{click:function(){if(e.fromBubble)e.tmpNode.src=y.src,e.hidden(),L();else{var a=SinaEditor.util.dom.createDom("img",{ownerDocument:b.entyDoc,properties:{src:y.src}});b.operation.addNode(a,!0),e.hidden(),L()}}}},{element:r,events:{click:function(){k.src="",H(g)}}},{element:s,events:{mousemove:function(a){var b=SinaEditor.util.dom.getXY(s),c=SinaEditor.util.dom.getScrollPos(),d=[10,15];SinaEditor.env.$IE&&(d[0]=200),h.style.left=a.clientX-b[0]-d[0]+c[1]+"px",h.style.top=a.clientY-b[1]-d[1]+c[0]+"px"}}},{element:j,events:{click:function(){q.src="",H(g)}}},{element:q,events:{load:function(){console.log(".......客户端的华丽家在！！！");try{var a=q.contentWindow.document.body.innerHTML;if(!a){console.log("没有加载东西！虚报");return}H(o),q.contentWindow.document.body.innerHTML="";var b=new Image;b.onload=function(){k.src=a,setTimeout(function(){J(k)},1)},b.src=a}catch(c){}}}},{element:h,events:{change:function(){!M(h.value)||(u.submit(),H(i))}}}]}}),SinaEditor.plugins.add("indent",function(a){var b=this;a.customerBtn||b.callPlugin({name:"indentBtn",args:a}),b.operation.indent=function(){b.focus(),b.operation.save(b),b.entyDoc.execCommand("indent",!1,""),b.operation.save(b),b.focus()}}),SinaEditor.plugins.add("indentBtn",function(a){var b=this,c={title:"增加缩进",normalClass:"ico_indent_1",disabledClass:"ico_indent_4",clickedClass:"ico_indent_3",mouseoverClass:"ico_indent_2",state:SinaEditor.BUTTONSTATE.DISABLED,group:"composing"};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.indent=d;return{initialize:function(){},events:[{element:d.$,events:{click:function(){if(d.getState()===SinaEditor.BUTTONSTATE.DISABLED)return!1;b.operation.indent();return!1}}}]}}),SinaEditor.plugins.add("initFromStatic",function(a){function c(){b.entyWin=b.enty.contentWindow,b.entyDoc=b.entyWin.document,b.entyBody=b.entyDoc.body,b.entyBody.spellcheck=!!b.option.disableNativeSpellChecker,SinaEditor.env.$IE?(b.entyBody.hideFocus=!0,b.entyBody.disabled=!0,b.entyBody.contentEditable=!0,b.entyBody.removeAttribute("disabled")):setTimeout(function(){if(SinaEditor.env.$GENKO){b.entyBody.contentEditable=!0;var a=!1;SinaEditor.ev.add(b.enty,"DOMAttrModified",function(a){var c=a.attrName.toUpperCase();if(c=="CLASS"||c=="STYLE")b.entyBody.contentEditable=!1,b.entyBody.contentEditable=!0,b.entyWin.blur(),b.entyWin.focus()})}else SinaEditor.env.$WEBKIT?b.entyBody.parentNode.contentEditable=!0:b.entyDoc.designMode="on"},0),setTimeout(function(){try{b.entyDoc.execCommand("enableObjectResizing",!1,!b.option.disableObjectResizing)}catch(a){}try{b.entyDoc.execCommand("enableInlineTableEditing",!1,!b.option.disableNativeTableHandles)}catch(a){}if(SinaEditor.env.$IE){try{document.execCommand("BackgroundImageCache",!1,!0)}catch(a){}setTimeout(function(){var a=b.entyDoc;if(a){var c=a.body;c.runtimeStyle.marginBottom="0px",c.runtimeStyle.marginBottom=""}},1e3)}},0);if(SinaEditor.env.$IE){var a=SinaEditor.util.dom.createDom("script",{ownerDocument:b.entyDoc,attributes:{type:"text/javascript",src:window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"ierange-m2_raw.js"}});b.entyDoc.getElementsByTagName("head")[0].appendChild(a)}if(b.option.styleLinks){var c=b.option.styleLinks,d;for(d=0;c[d];d++)SinaEditor.util.dom.addLink(c[d],b.entyDoc)}b.option.styles&&SinaEditor.util.dom.addStyles(b.option.styles,b.entyDoc)}var b=this,d="document.open();"+(SinaEditor.env.isCustomDomain?'document.domian="'+document.domain+'";':"")+"document.close();",e=SinaEditor.util.dom.createDomFromHTML('<iframe style="width:100%;height:100%;z-index:999;" frameBorder="0" src="'+(SinaEditor.env.$IE?"javascript:void(function(){"+encodeURIComponent(d)+"}())":"")+'"'+' allowTransparency="true"'+"></iframe>");b.enty=e,SinaEditor.ev.add(e,"load",c),a.parent.appendChild(e)}),SinaEditor.plugins.add("italic",function(a){var b=this;a.customerBtn||b.callPlugin({name:"italicBtn",args:a});var c=b.btns.italic;b.operation.italic=function(){var a=SinaEditor.range.getCurrentRanges(b.entyWin);a=a[0];if(!!a){var d=a.toString();b.operation.save(b);var e=b.operateState.italic;e?(console.log("执行去斜体操作"),SinaEditor.range.removeStyle(b,{useTagName:["i","em"]}),SinaEditor.range.removeStyle(b,{useTagName:"span",style:"fontStyle"}),c.setState(SinaEditor.BUTTONSTATE.NORMAL)):(console.log("执行斜体操作"),SinaEditor.range.applyStyle(b,{useTagName:"em"}),c.setState(SinaEditor.BUTTONSTATE.CLICKED)),b.operateState.italic=!e,b.operation.save(b)}};return{events:[{element:b,events:{editorSelectionChange:function(a,b,d){var e=SinaEditor.range.queryCommandState(this.entyDoc,"italic");e?c.setState(SinaEditor.BUTTONSTATE.CLICKED):c.setState(SinaEditor.BUTTONSTATE.NORMAL),this.operateState.italic=e},ctrli:function(){b.operation.italic(this)}}}]}}),SinaEditor.plugins.add("italicBtn",function(a){var b=this,c={title:"斜体",normalClass:"ico_italic_1",disabledClass:"ico_italic_4",clickedClass:"ico_italic_3",mouseoverClass:"ico_italic_2",state:SinaEditor.BUTTONSTATE.DISABLED,group:"common"};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.italic=d;return{events:[{element:d.$,events:{click:function(){if(b.btns.italic.getState()===SinaEditor.BUTTONSTATE.DISABLED)return!1;b.operation.italic();return!1}}}]}}),SinaEditor.plugins.add("justifycenter",function(a){var b=this;a.customerBtn||b.callPlugin({name:"justifycenterBtn",args:a}),b.operation.justifycenter=function(){b.operation.save(b),b.entyDoc.execCommand("Justifycenter","",""),b.operation.save(b)}}),SinaEditor.plugins.add("justifycenterBtn",function(a){var b=this,c={title:"居中",normalClass:"ico_justifycenter_1",disabledClass:"ico_justifycenter_4",clickedClass:"ico_justifycenter_3",mouseoverClass:"ico_justifycenter_2",state:SinaEditor.BUTTONSTATE.DISABLED,group:"composing"};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.justifycenter=d;return{initialize:function(){},events:[{element:d.$,events:{click:function(){if(d.getState()===SinaEditor.BUTTONSTATE.DISABLED)return!1;b.operation.justifycenter();return!1}}}]}}),SinaEditor.plugins.add("justifyleft",function(a){var b=this;a.customerBtn||b.callPlugin({name:"justifyleftBtn",args:a}),b.operation.justifyleft=function(){b.operation.save(b),b.entyDoc.execCommand("Justifyleft","",""),b.operation.save(b)}}),SinaEditor.plugins.add("justifyleftBtn",function(a){var b=this,c={title:"居左",normalClass:"ico_justifyleft_1",disabledClass:"ico_justifyleft_4",clickedClass:"ico_justifyleft_3",mouseoverClass:"ico_justifyleft_2",state:SinaEditor.BUTTONSTATE.DISABLED,group:"composing"};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.justifyleft=d;return{initialize:function(){},events:[{element:d.$,events:{click:function(){if(d.getState()===SinaEditor.BUTTONSTATE.DISABLED)return!1;b.operation.justifyleft();return!1}}}]}}),SinaEditor.plugins.add("justifyright",function(a){var b=this,c=null;a.customerBtn||b.callPlugin({name:"justifyrightBtn",args:a}),b.operation.justifyright=function(){b.operation.save(b),b.entyDoc.execCommand("justifyright","",""),b.operation.save(b)}}),SinaEditor.plugins.add("justifyrightBtn",function(a){var b=this,c={title:"居右",normalClass:"ico_justifyright_1",disabledClass:"ico_justifyright_4",clickedClass:"ico_justifyright_3",mouseoverClass:"ico_justifyright_2",state:SinaEditor.BUTTONSTATE.DISABLED,group:"composing"};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.justifyright=d;return{events:[{element:d.$,events:{click:function(){if(d.getState()===SinaEditor.BUTTONSTATE.DISABLED)return!1;b.operation.justifyright();return!1}}}]}}),function(){function a(a){var b=[],c=a.length;if(c>30){b.push(a.substring(0,15)),b.push(a.substring(c-15,c));return b.join("...")}return a}SinaEditor.plugins.add("linkBubble",SinaEditor.$abstract.BaseBubblePlugin({tagName:"A",applyStyles:SinaEditor.CONF.aBubbleStyles,showBubble:function(b,c){var d=b.href;if(!!d){var e=(new Date).getTime(),f,g,h="a_m_b_"+e,i="a_d_b_"+e;g={modifyid:h,deleteid:i};var j=d.match(/^mailto:(.*$)/i);j?(f=new SinaEditor.$abstract.Template(SinaEditor.CONF.mailBubbleTemplete),g.srcstr=a(j[1])):(f=new SinaEditor.$abstract.Template(SinaEditor.CONF.aBubbleTemplete),g.src=decodeURI(d),g.srcstr=a(decodeURI(d)));var k=SinaEditor.util.dom.getXY(b,!0),l=SinaEditor.util.dom.getXY(c.enty,!0);k[1]-=b.offsetHeight,l[1]>k[1]&&(k[1]=l[1]);var m=SinaEditor.baseBubble.showBubble(f.evaluate(g),{x:k[0],y:k[1]});SinaEditor.CONF.aBubbleModify?m.id(h).onclick=function(){SinaEditor.CONF.aBubbleModify(b)||SinaEditor.baseBubble.hiddenBubble();return!1}:m.id(h).style.display="none",SinaEditor.CONF.aBubbleDelete?m.id(i).onclick=function(){SinaEditor.CONF.aBubbleDelete(b)||SinaEditor.baseBubble.hiddenBubble();return!1}:m.id(i).style.display="none"}}}))}(),SinaEditor.plugins.add("link",function(a){var b=this,c=null;a.customerPanel||b.callPlugin({name:"linkPanel",args:a}),a.customerBtn||b.callPlugin({name:"linkBtn",args:a}),b.operation.link=function(a){b.focus();var c=a.range||SinaEditor.range.getCurrentRanges(b.entyWin)[0],d=a.link,e=a.str||d;if(!d&&!c)console.log("2a.不传递：不做任何操作。");else{b.operation.save(b);if(a.elm){var f=a.elm;a.link?(f.href=encodeURI(a.link),c.selectNodeContents(f),SinaEditor.range.applyRanges(b.entyWin,c)):SinaEditor.util.dom.removeTag(f)}else{var g=SinaEditor.util.dom.createDom("a",{ownerDocument:b.entyDoc,properties:{target:"_blank"}});if(!c||c&&c.collapsed)g.innerHTML=e,g.href=encodeURI(d),c?c.insertNode(g):b.entyBody.appendChild(g),c.selectNodeContents(g),SinaEditor.range.applyRanges(b.entyWin,c);else{b.entyDoc.execCommand("unlink",!1,"");if(d){g.href=encodeURI(d),c=SinaEditor.range.getCurrentRanges(b.entyWin)[0];try{c.surroundContents(g)}catch(h){var i=c.extractContents();g.appendChild(i),c.insertNode(g)}c.selectNodeContents(g),SinaEditor.range.applyRanges(b.entyWin,c)}}}b.operation.save(b)}}}),SinaEditor.plugins.add("linkBtn",function(a){var b=this,c=b.panels.link,d=c.nodes.hidden,e={title:" 插入链接",normalClass:"ico_link_1",disabledClass:"ico_link_4",clickedClass:"ico_link_3",mouseoverClass:"ico_link_2",state:SinaEditor.BUTTONSTATE.DISABLED,group:"common"};e=SinaEditor.util.mix(e,a.btnConf);var f=SinaEditor.ButtonFactory.createButton(e,b);b.btns.link=f;return{events:[{element:f.$,events:{click:function(){if(b.btns.link.getState()===SinaEditor.BUTTONSTATE.DISABLED)return!1;var a=SinaEditor.range.getCurrentRanges(b.entyWin)[0],e=a.toString();SinaEditor.TOOLCONF.addLinkNow&&SinaEditor.TOOLCONF.addLinkNow.test(e)?b.operation.link({link:e,range:a}):(a.collapsed&&(d.style.display=""),c.show());return!1}}}]}}),SinaEditor.plugins.add("linkPanel",function(a){var b=this,c=SinaEditor.winDialog.create({title:"添加链接",content:SinaEditor.TOOLCONF.linkTemplate,funcClose:function(){j()}});c.setMiddle(),c.setFixed(!0);var d=c.nodes.ok,e=c.nodes.cancel,f=c.nodes.text,g=c.nodes.hidden,h=c.nodes.link,i,j=function(){g.style.display="none",i=null,f.value="",h.value="http://"};b.panels.link=c,SinaEditor.CONF.aBubbleModify=function(a){h.value=decodeURI(a.href),i=a,c.show()},SinaEditor.CONF.aBubbleDelete=function(a){b.operation.link({elm:a})};return{events:[{element:d,events:{click:function(){b.operation.link({link:h.value,str:f.value,elm:i}),j(),c.hidden()}}},{element:e,events:{click:function(){j(),c.hidden()}}}]}}),SinaEditor.plugins.add("markList",function(a){var b=this,c=null;a.customerBtn||b.callPlugin({name:"markListBtn",args:a}),b.operation.markList=function(){b.operation.save(b),b.entyDoc.execCommand("insertunorderedlist","",""),b.focus(),b.operation.save(b)}}),SinaEditor.plugins.add("markListBtn",function(a){var b=this,c={title:"项目符号",normalClass:"ico_marklist_1",disabledClass:"ico_marklist_4",clickedClass:"ico_marklist_3",mouseoverClass:"ico_marklist_2",state:SinaEditor.BUTTONSTATE.DISABLED,group:"composing"};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.markList=d;return{events:[{element:d.$,events:{click:function(){if(d.getState()===SinaEditor.BUTTONSTATE.DISABLED)return!1;b.operation.markList();return!1}}}]}}),SinaEditor.plugins.add("numberList",function(a){var b=this,c=null;a.customerBtn||b.callPlugin({name:"numberListBtn",args:a}),b.operation.numberList=function(){b.operation.save(b),b.focus(),b.entyDoc.execCommand("insertorderedlist","",""),b.operation.save(b)}}),SinaEditor.plugins.add("numberListBtn",function(a){var b=this,c={title:"数字符号",normalClass:"ico_numberlist_1",disabledClass:"ico_numberlist_4",clickedClass:"ico_numberlist_3",mouseoverClass:"ico_numberlist_2",state:SinaEditor.BUTTONSTATE.DISABLED,group:"composing"};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.numberList=d;return{events:[{element:d.$,events:{click:function(){if(d.getState()===SinaEditor.BUTTONSTATE.DISABLED)return!1;b.operation.numberList();return!1}}}]}}),SinaEditor.plugins.add("outdent",function(a){var b=this;a.customerBtn||b.callPlugin({name:"outdentBtn",args:a}),b.operation.outdent=function(){b.focus(),b.operation.save(b),b.entyDoc.execCommand("outdent","",""),b.operation.save(b),b.focus()}}),SinaEditor.plugins.add("outdentBtn",function(a){var b=this,c={title:"减少缩进",normalClass:"ico_outdent_1",disabledClass:"ico_outdent_4",clickedClass:"ico_outdent_3",mouseoverClass:"ico_outdent_2",state:SinaEditor.BUTTONSTATE.DISABLED,group:"composing"};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.outdent=d;return{events:[{element:d.$,events:{click:function(){if(d.getState()===SinaEditor.BUTTONSTATE.DISABLED)return!1;b.operation.outdent();return!1}}}]}}),SinaEditor.plugins.add("pasteFilter",function(a){var b=this;b.operation.pasteFilter=function(){var a=b.option.filter.args,d=0,e=a.tagName;if(e){e=e.split("|");var f,g;while(e[d]){g=b.entyDoc.getElementsByTagName(e[d]);while(g[0])SinaEditor.util.dom.delElement(g[0]);d++}}var h=a.attribute;h&&(h=h.split("|"),c(b.entyDoc.body,h)),d=0;var i=b.entyDoc.getElementsByTagName("img");for(;i[d];d++)i[d].src.indexOf("file:///")===0&&(SinaEditor.util.dom.delElement(i[d]),d--)};var c=function(a,b){if(a.nodeType===SinaEditor.NODETYPE.ELEMENT){var d=0;while(b[d])a.removeAttribute(b[d]),d++;d=0;if(a.hasChildNodes()){var e=a.childNodes;while(e[d])c(e[d],b),d++}}},d=function(a){var c,d=0;while(a[d])c=SinaEditor.util.dom.createDomFromHTML('<img src="'+SinaEditor.CONF.transparentIMG+'" _se_flash="'+encodeURIComponent(SinaEditor.util.dom.outerHTML(a[d]))+'" width="'+a[d].width+'" height="'+a[d].height+'" style="background:url(\''+SinaEditor.CONF.fakeFLASH+"') no-repeat scroll center center transparent;border:1px solid #A9A9A9;\" >",b.entyDoc),a[d].parentNode.replaceChild(c,a[d])},e=function(){var a=b.entyDoc.getElementsByTagName("img"),c,d,e=0;while(a[e])c=a[e].getAttribute("_se_flash"),c?(d=SinaEditor.util.dom.createDomFromHTML(decodeURIComponent(c),b.entyDoc),a[e].parentNode.replaceChild(d,a[e])):e++};return{events:[{element:b.entyBody,events:{paste:function(a){setTimeout(function(){var a=0,c;b.operation.pasteFilter(),d(b.entyDoc.getElementsByTagName("object")),d(b.entyDoc.getElementsByTagName("embed")),c=b.entyDoc.getElementsByTagName("td");for(a=0;c[a];a++){var e=c[a].textContent||c[a].textContent;e||(c[a].innerHTML="&nbsp;")}},10)}}},{element:b,events:{editorStateChange:function(){var a=this.getState();a==SinaEditor.STATE.EDITING?(d(this.entyDoc.getElementsByTagName("object")),d(this.entyDoc.getElementsByTagName("embed"))):a==SinaEditor.STATE.SHOWSOURCE&&e()}}}]}}),SinaEditor.plugins.add("redoManager",function(a){var b=this;SinaEditor.redoManager.addEditor(b),b._.doManagerBuffer=500,b.operation.redo=function(a){SinaEditor.redoManager.redo(b)},b.operation.undo=function(a){SinaEditor.redoManager.undo(b)},b.operation.save=function(a){SinaEditor.redoManager.save(b)},b.operation.clearRU=function(a){SinaEditor.redoManager.addEditor(b)},a.customerBtnU||b.callPlugin({name:"undoBtn",args:a}),a.customerBtnR||b.callPlugin({name:"redoBtn",args:a});return{events:[{element:b,events:{ctrly:function(a){SinaEditor.redoManager.redo(b)},ctrlz:function(a){SinaEditor.redoManager.undo(b)}}},{element:b.entyDoc,events:{keydown:function(a){setTimeout(function(){b.entyWin.clearTimeout(b._.doManagerBufferTimmer),b._.doManagerBufferTimmer=b.entyWin.setTimeout(function(){console.log("空闲"+b._.doManagerBuffer+"毫秒就保存"),SinaEditor.redoManager.save(b)},b._.doManagerBuffer)},0)}}}]}}),SinaEditor.plugins.add("redoBtn",function(a){var b=this,c={title:"重做",normalClass:"ico_redo_1",disabledClass:"ico_redo_4",clickedClass:"ico_redo_3",state:SinaEditor.BUTTONSTATE.DISABLED,group:"redoAndUndo"};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.redo=d;return{events:[{element:b,events:{redoAndUndoChanged:function(){b._.hasRedo?d.setState(SinaEditor.BUTTONSTATE.NORMAL):d.setState(SinaEditor.BUTTONSTATE.DISABLED)}}},{element:d.$,events:{click:function(){b.getState()==SinaEditor.STATE.EDITING&&SinaEditor.redoManager.redo(b)},mouseover:function(){b._.hasRedo&&d.getState()===SinaEditor.BUTTONSTATE.NORMAL&&(this.className="ico_redo_2")},mouseout:function(){this.className="ico_redo_4",b._.hasRedo&&d.getState()===SinaEditor.BUTTONSTATE.NORMAL&&(this.className="ico_redo_1")}}}]}}),SinaEditor.plugins.add("showSource",function(a){var b=this;b.entyArea=a.entyArea;if(!b.entyArea){var c=SinaEditor.util.dom.createDom("textarea",{attributes:{id:b.option.id+"_area_"+ +(new Date)}});c.style.cssText="width:100%;height:100%;display:none;resize:none;",b.entyArea=c,b.enty.parentNode.appendChild(c)}SinaEditor.env.$IE&&(b.entyArea.style.height=b.enty.offsetHeight+"px"),b.customerBtn||b.callPlugin({name:"showSourceBtn",args:a}),b.operation.swapData=function(a){var c,d=b.operation.pasteFilter||function(){};a?(b.setState(SinaEditor.STATE.SHOWSOURCE),d(),SinaEditor.env.$IE?b.entyArea.value=b.entyBody.innerHTML:b.entyArea.value=SinaEditor.util.styleHTML(b.entyBody.innerHTML,1,"\t"),b.entyBody.innerHTML=""):(b.entyBody.innerHTML=b.entyArea.value.replace(/\u200B|\t|\n|\r/g,""),d(),b.setState(SinaEditor.STATE.EDITING))};return{initialize:function(){b.entyArea.style.display="none",b.enty.style.display="",b.focus(),SinaEditor.redoManager.addEditor(b)}}}),SinaEditor.plugins.add("showSourceBtn",function(a){var b=this;SinaEditor.BUTTON.source=function(a){switch(this.getState()){case SinaEditor.STATE.CREATING:a.setState(SinaEditor.BUTTONSTATE.DISABLED);break;default:a.setState(SinaEditor.BUTTONSTATE.NORMAL)}};var c={title:"查看源代码",normalClass:"ico_showsrc_1",disabledClass:"ico_showsrc_4",clickedClass:"ico_showsrc_3",mouseoverClass:"ico_showsrc_2",state:SinaEditor.BUTTONSTATE.DISABLED,editorChangeType:"source",group:"common"};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.showSource=d;return{events:[{element:d.$,events:{click:function(){var a=b.getState();a===SinaEditor.STATE.EDITING?(b.operation.save(b),b.enty.style.display="none",b.entyArea.style.display="",b.operation.swapData(!0),b.entyArea.focus()):a===SinaEditor.STATE.SHOWSOURCE&&(b.operation.swapData(!1),b.entyArea.style.display="none",b.enty.style.display="",b.focus(),b.operation.save(b))}}}]}}),SinaEditor.plugins.add("submit",function(a){var b=this;b.operation.submit=function(){var a=""
,c=b.operation.pasteFilter||function(){};swapData=b.operation.swapData||function(){},swapData(!0),a=b.entyArea.value,swapData(!1);return a}}),SinaEditor.plugins.add("tableUI",function(a){var b=this;a.customerBtn||b.callPlugin({name:"tableUIBtn",args:a}),a.customerPanel||b.callPlugin({name:"tableUIPanel",args:a}),b.operation.tableCreate=function(a,c,d){if(!(a<=0||c<=0)){b.operation.save(b);var e=['<table cellspacing="1" cellpadding="3" style="width:80%;text-align:center;" border="1" >'],f,g;for(f=0;f<c;f++){e.push("<tr>");for(g=0;g<a;g++)e.push("<td>&nbsp;</td>");e.push("</tr>")}e.push("</table>");var h=SinaEditor.util.dom.createDomFromHTML(e.join(""),b.entyDoc);b.operation.addNode(h),b.operation.save(b)}}}),SinaEditor.plugins.add("tableUIBtn",function(a){var b=this,c={title:"插入表格",normalClass:"ico_table_1",disabledClass:"ico_table_4",clickedClass:"ico_table_3",mouseoverClass:"ico_table_2",state:SinaEditor.BUTTONSTATE.DISABLED,group:"richdata"};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.tableUI=d,b.btns.tableUI.PANELX=0,b.btns.tableUI.PANELY=0;return{events:[{element:d.$,events:{click:function(){if(d.getState()===SinaEditor.BUTTONSTATE.DISABLED)return!1;var a=b.panels.tableUI,c=SinaEditor.util.dom.getScrollPos(),e=SinaEditor.util.dom.getXY(d.$);a.setPosition({x:e[0],y:e[1]+d.$.offsetHeight}),a.nodes.chooseContent.style.width="0em",a.nodes.chooseContent.style.height="0em",a.show();var f=SinaEditor.util.dom.getXY(a.nodes.panel);b.btns.tableUI.PANELX=f[0],b.btns.tableUI.PANELY=f[1];return!1}}}]}}),SinaEditor.plugins.add("tableUIPanel",function(a){var b=this,c=null,d=a.colors||SinaEditor.TOOLCONF.COLOR,e=new SinaEditor._.Panel;e.setTemplate(SinaEditor.TOOLCONF.tableTemplate);var f=e.nodes.panel,g=e.nodes.eventContent,h=e.nodes.baseContent,i=e.nodes.chooseContent,j=e.nodes.tabNums;b.panels.tableUI=e;return{events:[{element:g,events:{mousemove:function(a){var c=b.btns.tableUI,d=SinaEditor.util.dom.getScrollPos(),e=parseInt((a.clientX-c.PANELX+d[1])/16,10)||1,f=parseInt((a.clientY-c.PANELY+d[0])/16,10)||1;e=e>20?20:e,f=f>20?20:f,i.style.width=e+"em",i.style.height=f+"em";var k=(e<5?5:e)+"em";h.style.width=k,h.style.height=(f<5?5:f)+"em",g.style.width=k,j.innerHTML=[e," * "+f].join("")}}},{element:document,events:{click:function(a){var c=a.target;SinaEditor.util.dom.containsNode(b.btns.tableUI.$,c)||SinaEditor.util.dom.containsNode(f,c)||e.hidden()}}},{element:i,events:{click:function(a){var c=j.innerHTML,d=c.split("*");b.operation.tableCreate(parseInt(d[0],10),parseInt(d[1],10)),e.hidden()}}},{element:b,events:{editorSelectionChange:function(){e.hidden()}}}]}}),SinaEditor.plugins.add("underline",function(a){var b=this;a.customerBtn||b.callPlugin({name:"underlineBtn",args:a});var c=b.btns.underline;b.operation.underline=function(a){var d=SinaEditor.range.getCurrentRanges(b.entyWin);d=d[0];if(!!d){b.operation.save(b);var e=b.operateState.underline;e?(console.log("执行去下划线操作"),SinaEditor.range.removeStyle(b,{useTagName:"span",style:"textDecoration"}),c.setState(SinaEditor.BUTTONSTATE.NORMAL)):(console.log("执行加下划线操作"),SinaEditor.range.applyStyle(b,{useTagName:"span",style:"textDecoration",value:"underline"}),c.setState(SinaEditor.BUTTONSTATE.CLICKED)),b.operateState.underline=!e,b.operation.save(b)}};return{events:[{element:b,events:{editorSelectionChange:function(a,b,d){var e=SinaEditor.range.queryCommandState(this.entyDoc,"underline");e?c.setState(SinaEditor.BUTTONSTATE.CLICKED):c.setState(SinaEditor.BUTTONSTATE.NORMAL),this.operateState.underline=e},ctrlu:function(){b.operation.isUnderline(this)}}}]}}),SinaEditor.plugins.add("underlineBtn",function(a){var b=this,c={title:"下划线",normalClass:"ico_underline_1",disabledClass:"ico_underline_4",clickedClass:"ico_underline_3",mouseoverClass:"ico_underline_2",state:SinaEditor.BUTTONSTATE.DISABLED,group:"common"};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.underline=d;return{events:[{element:d.$,events:{click:function(){b.operation.underline(b)}}}]}}),SinaEditor.plugins.add("undoBtn",function(a){var b=this,c={title:"撤销",normalClass:"ico_undo_1",disabledClass:"ico_undo_4",clickedClass:"ico_undo_3",state:SinaEditor.BUTTONSTATE.DISABLED,group:"redoAndUndo"};c=SinaEditor.util.mix(c,a.btnConf);var d=SinaEditor.ButtonFactory.createButton(c,b);b.btns.undo=d;return{events:[{element:b,events:{redoAndUndoChanged:function(){b._.hasUndo?d.setState(SinaEditor.BUTTONSTATE.NORMAL):d.setState(SinaEditor.BUTTONSTATE.DISABLED)}}},{element:d.$,events:{click:function(){b.getState()==SinaEditor.STATE.EDITING&&SinaEditor.redoManager.undo(b)},mouseover:function(){console.log("112233"),b._.hasUndo&&d.getState()===SinaEditor.BUTTONSTATE.NORMAL&&(this.className="ico_undo_2")},mouseout:function(){this.className="ico_undo_4",b._.hasUndo&&d.getState()===SinaEditor.BUTTONSTATE.NORMAL&&(this.className="ico_undo_1")}}}]}}),SinaEditor.$abstract||(SinaEditor.$abstract={}),SinaEditor.$abstract.baseEditor=function(a){this._state=SinaEditor.STATE.CREATING,this.option=a||{},this.option.eventBlackList=this.option.eventBlackList||"",this._jobTable=[],this._jobTableIndex={},this.enty=null,this.entyWin=null,this.entyDoc=null,this.entyBody=null,this.entyArea=null,this.hasAddEvent=!1,this.btns={},this.panels={},this._={},this.errorMsg=[],this.operation={},this.operateState={}}.$define({error:function(a){console.error(a),this.errorMsg.push(a)},add:function(a){this._jobTable.push(a)},start:function(){this.option.onStart&&this.option.onStart(),this.queue(this._jobTable)},queue:function(a,b){var c=this,d=a.length,e=0;c.callPlugin(a[e]);var f=window.setInterval(function(){e++;if(e>=d)clearInterval(f),f=null,SinaEditor.ev.fire(c,"editorOnladed");else if(c.entyWin){if(!c.hasAddEvent){c.hasAddEvent=!0;var b=null;for(b in SinaEditor.ev.customEvent)c.option.eventBlackList.indexOf(b)<0?SinaEditor.ev.$regEvent(b,c):console.log(c.option.id+"在黑名单中："+b)}c.callPlugin(a[e]),c.setState(SinaEditor.STATE.CREATED),c.setState(SinaEditor.STATE.EDITING)}else console.log("等一下"),e--},10)},callPlugin:function(a){var b=function(){return(new Date).valueOf()},c=SinaEditor.plugins.get(a.name);if(!c)console.log(a),console.log("---------------------------plugin not found:");else{var d=c.call(this,a.args||{})||{};console.log(this.option.id+"添加job:"+a.name);var e=d.initialize,f=d.events;if(typeof d=="undefined"){this.error("<b>Job["+a.name+"] is undefiend!!!</b>");return}var g=!0,h=b();try{if(f){var i=0;for(i=0;f[i];i++){var j=f[i],k=j.element,l=j.events,m=null;k||console.error("!!!!!+"+m+"+绑定失败...");for(m in l)console.log(k+"绑定"+m),SinaEditor.ev.add(k,m,l[m],{srcEditor:this})}}e&&e.call(this)}catch(n){this.error("<b>Job["+a.name+"] failed!!!</b>"+n.message+""),g=!1;throw n}finally{if(g)var o=b()}}},focus:function(){this.entyWin.focus()},setState:function(a){this._state=a,SinaEditor.ev.fire(this,"editorStateChange")},getState:function(){return this._state}}),SinaEditor.createEditor=function(conf){var job=new(eval("("+conf.editorName+")"))(conf),pName=conf.plugns,i;job.add(conf.initType),conf.filter&&job.add(conf.filter);for(i=0;pName[i];i++)job.add(pName[i]);job.start();return job},SinaEditor._={},SinaEditor._||(SinaEditor._={}),SinaEditor._.entyimpl={},SinaEditor._.entyimpl.normalEditor=function(){}.$extends(SinaEditor.$abstract.baseEditor).$define({}),SinaEditor._.IRenderer={setCanShow:function(a){},setCanHidden:function(a){},show:function(a){},hidden:function(a){},addEventListener:function(a,b){},removeEventListener:function(a,b){}},SinaEditor._.OpacityRenderer=function(){this.__canShow=!0,this.__canHidden=!0,this.__node=null,this.__tween=new SinaEditor._.TweenStrategy(0,0,.6,SinaEditor._.Transition.strongEaseOut),this.__state="",this.__lastState="",this.__value=0,this.__node=null,this.__eventDispatcher=new SinaEditor._.EventDispatcher(this),this.__initTweenEvent()}.$implements(SinaEditor._.IRenderer).$define({setCanShow:function(a){this.__canShow=!!a},setCanHidden:function(a){this.__canHidden=!!a},show:function(a){var b=this.__tween;b.stop(),SinaEditor.util.dom.setStyle(a,"opacity",this.__value),a.style.display="",this.__node=a,this.__state="show",this.__eventDispatcher.dispatchEvent("beforeShow"),this.__canShow&&(b.startValue=this.__value,b.endValue=1,b.start());return this},hidden:function(a){var b=this.__tween;b.stop(),this.__node=a,this.__state="hidden",this.__eventDispatcher.dispatchEvent("beforeHidden"),this.__canHidden&&(b.startValue=this.__value,b.endValue=0,b.start());return this},addEventListener:function(a,b){this.__eventDispatcher.addEventListener(a,b);return this},removeEventListener:function(a,b){this.__eventDispatcher.removeEventListener(a,b);return this},__initTweenEvent:function(){var a=this;this.__tween.addEventListener("tween",function(b){a.__value=b,SinaEditor.util.dom.setStyle(a.__node,"opacity",b)}),this.__tween.addEventListener("end",function(){a.__node&&a.__node.style.filter&&(a.__node.style.filter=""),a.__state!==""&&a.__state!==a.__lastState&&(a.__lastState=a.__state,a.__eventDispatcher.dispatchEvent(a.__state)),a.__state==="hidden"&&(a.__node.style.display="none")})}}),SinaEditor._.SimpleRenderer=function(){this.__canShow=!0,this.__canHidden=!0,this.__eventDispatcher=new SinaEditor._.EventDispatcher(this)}.$implements(SinaEditor._.IRenderer).$define({setCanShow:function(a){this.__canShow=!!a},setCanHidden:function(a){this.__canHidden=!!a},show:function(a){this.__eventDispatcher.dispatchEvent("beforeShow"),this.__canShow&&(a.style.display="",this.__eventDispatcher.dispatchEvent("show"));return this},hidden:function(a){this.__eventDispatcher.dispatchEvent("beforeHidden"),this.__canHidden&&(a.style.display="none",this.__eventDispatcher.dispatchEvent("hidden"));return this},addEventListener:function(a,b){this.__eventDispatcher.addEventListener(a,b);return this},removeEventListener:function(a,b){this.__eventDispatcher.removeEventListener(a,b);return this}}),SinaEditor._.Transition={simple:function(a,b,c,d){return c*a/d+b},backEaseIn:function(a,b,c,d){var e=1.70158;return c*(a/=d)*a*((e+1)*a-e)+b},backEaseOut:function(a,b,c,d){var e=1.70158;return c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},backEaseInOut:function(a,b,c,d){var e=1.70158;return(a/=d/2)<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},bounceEaseOut:function(a,b,c,d){return(a/=d)<1/2.75?c*7.5625*a*a+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},bounceEaseIn:function(a,b,c,d){return c-Transition.bounceEaseOut(d-a,0,c,d)+b},bounceEaseInOut:function(a,b,c,d){return a<d/2?Transition.bounceEaseIn(a*2,0,c,d)*.5+b:Transition.bounceEaseOut(a*2-d,0,c,d)*.5+c*.5+b},regularEaseIn:function(a,b,c,d){return c*(a/=d)*a+b},regularEaseOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},regularEaseInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},strongEaseIn:function(a,b,c,d){return c*(a/=d)*a*a*a*a+b},strongEaseOut:function(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b},strongEaseInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b},elasticEaseIn:function(a,b,c,d){var e,f,g;if(a===0)return b;if((a/=d)==1)return b+c;f=d*.3,!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e);return-(e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f))+b},elasticEaseOut:function(a,b,c,d){var e,f,g;if(a===0)return b;if((a/=d)==1)return b+c;f||(f=d*.3),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e);return e*Math.pow(2,-10*a)*Math.sin((a*d-g)*2*Math.PI/f)+c+b},elasticEaseInOut:function(a,b,c,d){var e,f,g;if(a===0)return b;if((a/=d/2)==2)return b+c;f||(f=d*.3*1.5),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e);return a<1?-0.5*e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f)+b:e*Math.pow(2,-10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f)*.5+c+b}},SinaEditor._.TweenStrategy=function(a,b,c,d){this.startValue=a||0,this.endValue=b||0,this.duration=c||0,this.motion=d||SinaEditor._.Transition.simple,this.__eventDispatcher=new SinaEditor._.EventDispatcher(this)}.$define({motion:null,duration:0,startValue:0,endValue:0,_itvID:0,_isTweenning:!1,addEventListener:function(a,b){this.__eventDispatcher.addEventListener(a,b);return this},removeEventListener:function(a,b){this.__eventDispatcher.removeEventListener(a,b);return this},start:function(){if(!this._isTweenning){this._isTweenning=!0;var a=this,b,c=this.startValue,d=this.endValue,e=this.duration,f,g=(new Date).getTime();this._itvID=window.setInterval(function(){b=((new Date).getTime()-g)/1e3,b>a.duration&&(b=a.duration),f=a.motion(b,c,d-c,e),a.onTween&&a.onTween(f),a.__eventDispatcher.dispatchEvent("tween",f),b===a.duration&&a.stop()},25);return this}},stop:function(){window.clearInterval(this._itvID),this._isTweenning=!1,this.onEnd&&this.onEnd(),this.__eventDispatcher.dispatchEvent("end");return this},onTween:function(a){},onEnd:function(){}}),SinaEditor._.IDragger={addEventListener:function(a,b){},removeEventListener:function(a,b){},setDrag:function(a,b,c){},setLock:function(a){},setArea:function(a){},destroy:function(){}},SinaEditor._.BorderDragger=function(){this.__drag=null,this.__isBindEvent=!1,this.__border=null,this.__dragNode=null,this.__isCreated=!1,this.__tweenX=new SinaEditor._.TweenStrategy(0,0,.5,SinaEditor._.Transition.strongEaseOut),this.__tweenY=new SinaEditor._.TweenStrategy(0,0,.5,SinaEditor._.Transition.strongEaseOut),this.__eventDispatcher=new SinaEditor._.EventDispatcher(this)}.$implements(SinaEditor._.IDragger).$define({addEventListener:function(a,b){a.toLowerCase()==="afterdrag"?this.__eventDispatcher.addEventListener(a,b):this.__drag.addEventListener(a,b);return this},removeEventListener:function(a,b){a.toLowerCase()==="afterdrag"?this.__eventDispatcher.removeEventListener(a,b):this.__drag.removeEventListener(a,b);return this},setDrag:function(a,b,c){this.__isCreated||(this.__createBorder(b),this.__initTweenEvent(b)),this.__drag=new SinaEditor._.Drag(a,this.__border,c),this.__dragNode=b,this.__initDragEvent();return this},setLock:function(a){this.__drag.isLock=!!a;return this},setArea:function(a){this.__drag.lockArea=a;return this},destroy:function(){this.__drag.destroy()},__createBorder:function(a){this.__border=SinaEditor.util.dom.createDom("div");var b=this.__border.style;b.border="2px dashed #BCC4D0",b.position="absolute",b.display="none",b.backgroundColor="transparent",b.MozUserSelect="none",document.body.appendChild(this.__border),this.__isCreated=!0},__initDragEvent:function(){if(!this.__isBindEvent){var a=this,b=this.__border.style,c=this.__dragNode.style,d=this.__tweenX,e=this.__tweenY;this.__drag.addEventListener("beforeDrag",function(){b.zIndex=c.zIndex+1,b.position=c.position,b.width=a.__dragNode.offsetWidth-4+"px",b.height=a.__dragNode.offsetHeight-4+"px",b.left=parseInt(c.left,10)+"px",b.top=parseInt(c.top,10)+"px",b.display=""}),this.__drag.addEventListener("afterDrag",function(){SinaEditor.env.$IE6?(c.left=parseInt(b.left,10)+"px",c.top=parseInt(b.top,10)+"px",b.display="none",a.__eventDispatcher.dispatchEvent("afterDrag")):(d.startValue=parseInt(c.left,10),d.endValue=parseInt(b.left,10),e.startValue=parseInt(c.top,10),e.endValue=parseInt(b.top,10),d.start(),e.start())}),this.__isBindEvent=!0}},__initTweenEvent:function(a){var b=a.style,c=this.__border.style,d=this;this.__tweenX.addEventListener("tween",function(a){b.left=a+"px"}),this.__tweenY.addEventListener("tween",function(a){b.top=a+"px"}),this.__tweenX.addEventListener("end",function(){c.display="none",d.__eventDispatcher.dispatchEvent("afterDrag")})}}),SinaEditor._.SimpleDragger=function(){this.__drag=null,this.__eventDispatcher=new SinaEditor._.EventDispatcher(this)}.$implements(SinaEditor._.IDragger).$define({addEventListener:function(a,b){a.toLowerCase()==="afterdrag"?this.__eventDispatcher.addEventListener(a,b):this.__drag.addEventListener(a,b);return this},removeEventListener:function(a,b){a.toLowerCase()==="afterdrag"?this.__eventDispatcher.removeEventListener(a,b):this.__drag.removeEventListener(a,b);return this},setDrag:function(a,b,c){var d=this;this.__drag=new SinaEditor._.Drag(a,b,c),this.__drag.addEventListener("afterDrag",function(){d.__eventDispatcher.dispatchEvent("afterDrag")});return this},setLock:function(a){this.__drag.isLock=!!a;return this},setArea:function(a){this.__drag.lockArea=a;return this},destroy:function(){this.__drag.destroy()}}),function(){function b(a,b){var c=b.call(a);return typeof c=="string"||typeof c=="number"?c:null}function a(a){return typeof a!="string"&&String.prototype.slice.call(a,0,8)=="function"}SinaEditor._.defineGetter=function(c,d,e){if(d instanceof Array&&e instanceof Array){var f=Math.min(d.length,e.length);while(f--)typeof d[f]=="string"&&a(e[f])&&(c[d[f]]={valueOf:function(a){return function(){return b(c,e[a])}}(f),toString:this.valueOf})}else typeof d=="string"&&a(e)&&(c[d]={valueOf:function(){return b(c,e)},toString:this.valueOf})}}(),SinaEditor._.DisplayObject=function(a,b){SinaEditor._.defineGetter(this,["x","y","z","width","height"],[this.__getX,this.__getY,this.__getZ,this.__getWidth,this.__getHeight]),this.__renderer=null,this.__entity=b,this.__isInited=!1,this.__parent=a||document.body,this.__eventDispatcher=new SinaEditor._.EventDispatcher(this);var c=this.__eventDispatcher;this.__onBeforeShow=function(){c.dispatchEvent("beforeShow")},this.__onShow=function(){c.dispatchEvent("show")},this.__onBeforeHidden=function(){c.dispatchEvent("beforeHidden")},this.__onHidden=function(){c.dispatchEvent("hidden")},this.__updateRenderer(SinaEditor._.SimpleRenderer)}.$define({setPosition:function(a){this.__isInited||this.__initEntity(),typeof a.x!="undefined"&&(this.__entity.style.left=a.x+"px"),typeof a.y!="undefined"&&(this.__entity.style.top=a.y+"px"),typeof a.z!="undefined"&&(this.__entity.style.zIndex=a.z);return this},setSize:function(a){this.__isInited||this.__initEntity(),typeof a.width!="undefined"&&(this.__entity.style.width=a.width+"px"),typeof a.height!="undefined"&&(this.__entity.style.height=a.height+"px");return this},setRenderer:function(a){this.__isInited||this.__initEntity(),this.__updateRenderer(a);return this},show:function(a){this.__isInited||this.__initEntity(),this.__updateRenderer(a),this.__renderer.show(this.__entity);return this},hidden:function(a){this.__isInited||this.__initEntity(),this.__updateRenderer(a),this.__renderer.hidden(this.__entity);return this},setCanShow:function(a){this.__renderer.setCanShow(a);return this},setCanHidden:function(a){this.__renderer.setCanHidden(a);return this},addEventListener:function(a,b){this.__eventDispatcher.addEventListener(a,b);return this},removeEventListener:function(a,b){this.__eventDispatcher.removeEventListener(a,b);return this},destroy:function(){!this.__entity||(this.__isInited||this.__initEntity(),this.__entity.parentNode&&this.__entity.parentNode.removeChild(this.__entity),this.__entity=null)},__initEntity:function(){var a;this.__entity||(this.__entity=SinaEditor.util.dom.createDom("div")),a=this.__entity.style,a.position="absolute",a.left=0,a.top=0,a.zIndex=0,this.__entity.parentNode||this.__parent.appendChild(this.__entity),this.__isInited=!0},__updateRenderer:function(a){if(!!a){var b=function(){this.__renderer.addEventListener("beforeShow",this.__onBeforeShow).addEventListener("show",this.__onShow).addEventListener("beforeHidden",this.__onBeforeHidden).addEventListener("hidden",this.__onHidden)};this.__renderer?this.__renderer.constructor!==a&&(this.__renderer.removeEventListener("beforeShow",this.__onBeforeShow).removeEventListener("show",this.__onShow).removeEventListener("beforeHidden",this.__onBeforeHidden).removeEventListener("hidden",this.__onHidden),this.__renderer=new a,b.call(this)):(this.__renderer=new a,b.call(this))}},__getX:function(){this.__isInited||this.__initEntity();return parseInt(this.__entity.style.left,10)},__getY:function(){this.__isInited||this.__initEntity();return parseInt(this.__entity.style.top,10)},__getZ:function(){this.__isInited||this.__initEntity();return parseInt(this.__entity.style.zIndex,10)},__getWidth:function(){this.__isInited||this.__initEntity();return this.__getSize(this.__entity,"offsetWidth")},__getHeight:function(){this.__isInited||this.__initEntity();return this.__getSize(this.__entity,"offsetHeight")},__getSize:function(a,b){var c=a,d,e=c.style.visibility;c.style.display=="none"?(c.style.visibility="hidden",c.style.display="",d=c[b],c.style.display="none",c.style.visibility=e):d=c[b];return d}}),SinaEditor._.Drag=function(a,b,c){var d=this;this.canDrag=!0,this.isLock=!1,this.lockArea={left:0,right:0,top:0,bottom:0},this.__captureNode=a,this.__dragNodes=[],this.__deltaX=[],this.__deltaY=[],this.__eventDispatcher=new SinaEditor._.EventDispatcher(this),this.__isDraging=!1,this.__canDragX=!0,this.__canDragY=!0,this.__dragHandle=function(){d.__drag()},this.__mouseDownHandle=function(){d.__isDraging=!0,d.__eventDispatcher.dispatchEvent("beforeDrag"),d.__setCapture(!0)},this.__mouseUpHandle=function(){d.__isDraging&&d.__eventDispatcher.dispatchEvent("afterDrag"),d.__isDraging=!1,d.__setCapture(!1)},this.__initNodes(a,b,c),this.__initCaputerNode()}.$define({addEventListener:function(a,b){this.__eventDispatcher.addEventListener(a,b);return this},__getEvent:function(){if(window.event)return window.event;var a=arguments.callee.caller,b,c=0;while(a!==null&&c<40){b=a.arguments[0];if(!b||b.constructor!=Event&&b.constructor!=MouseEvent)c++,a=a.caller;else return b}return b},removeEventListener:function(a,b){this.__eventDispatcher.removeEventListener(a,b);return this},destroy:function(){SinaEditor.ev.remove(this.__captureNode,"mousedown",this.__mouseDownHandle),SinaEditor.ev.remove(document,"mouseup",this.__mouseUpHandle),this.__captureNode=null,this.__dragNodes=null},__initNodes:function(a,b,c){b?(b instanceof Array?this.__dragNodes=b:this.__dragNodes.push(b),(typeof c=="undefined"||c)&&this.__dragNodes.push(this.__captureNode)):this.__dragNodes.push(this.__captureNode);var d=this.__dragNodes,e=d.length;while(e--)d[e].style.position||(d[e].style.position="absolute"),d[e].style.left||(d[e].style.left=0),d[e].style.top||(d[e].style.top=0)},__initCaputerNode:function(){var a=this.__captureNode,b=this;SinaEditor.ev.add(a,"mousedown",this.__mouseDownHandle),SinaEditor.ev.add(document,"mouseup",this.__mouseUpHandle)},__setCapture:function(a){var b=this.__captureNode,c=this.__dragNodes,d=this.__getEvent(),e=c.length;while(e--)this.__deltaX[e]=d.clientX-parseInt(c[e].style.left,10),this.__deltaY[e]=d.clientY-parseInt(c[e].style.top,10);a?SinaEditor.env.$IE?(b.setCapture(),SinaEditor.ev.add(b,"mousemove",this.__dragHandle)):SinaEditor.ev.add(document,"mousemove",this.__dragHandle):SinaEditor.env.$IE?(b.releaseCapture(),SinaEditor.ev.remove(b,"mousemove",this.__dragHandle)):SinaEditor.ev.remove(document,"mousemove",this.__dragHandle)},__drag:function(){if(!!this.canDrag){var a=this.__dragNodes,b=this.__getEvent(),c=a.length,d=this.lockArea,e=0,f=0;this.__eventDispatcher.dispatchEvent("drag");while(c--)e=b.clientX-this.__deltaX[c],f=b.clientY-this.__deltaY[c],this.isLock&&(e=Math.min(Math.max(e,d.left),d.right),f=Math.min(Math.max(f,d.top),d.bottom)),a[c].style.left=e+"px",a[c].style.top=f+"px"}}}),SinaEditor._.EventDispatcher=function(a){this.__target=a,this.__events={}}.$define({addEventListener:function(a,b){if(!!this.__checkFunction(b)){var c=this.__events;a=a.toLowerCase(),c[a]||(c[a]=[]),c[a].push(b)}},removeEventListener:function(a,b){var c=this.__events[a];a=a.toLowerCase();if(!(!this.__checkFunction(b)||!c||!c.length)){var d=0;for(d=c.length-1;d>=0;d--)c[d]===b&&c.splice(d,1)}},dispatchEvent:function(a){a=a.toLowerCase();var b=this.__events[a];if(!!b&&!!b.length){var c=Array.prototype.slice.call(arguments,0),d=0;c.shift();for(d=0,l=b.length;d<l;d++)b[d].apply(this.__target,c)}},__checkFunction:function(a){return typeof a!="string"&&String.prototype.slice.call(a,0,8)=="function"}}),SinaEditor._.IE6FixedController=function(){var a=this;this.node=null,this.iframeNode=null,this.__orgX=0,this.__orgY=0,this.__isBindScroll=!1,this.__fixedHandle=function(){a.node&&(a.node.style.left=document.documentElement.scrollLeft+a.__orgX+"px",a.node.style.top=document.documentElement.scrollTop+a.__orgY+"px"),a.iframeNode&&(a.iframeNode.style.left=a.node.style.left,a.iframeNode.style.top=a.node.style.top)}}.$define({setFixed:function(a,b){this.updateOrgPosition(),b&&!this.__isBindScroll&&(SinaEditor.ev.add(window,"scroll",this.__fixedHandle),this.__isBindScroll=!0),!b&&this.__isBindScroll&&(SinaEditor.ev.remove(window,"scroll",this.__fixedHandle),this.__isBindScroll=!1)},setPosition:function(a,b,c){typeof c.x!="undefined"&&(b?(a.style.left=c.x+document.documentElement.scrollLeft+"px",this.__orgX=parseInt(this.node.style.left,10)-document.documentElement.scrollLeft):a.style.left=c.x+"px"),typeof c.y!="undefined"&&(b?(a.style.top=c.y+document.documentElement.scrollTop+"px",this.__orgY=parseInt(this.node.style.top,10)-document.documentElement.scrollTop):a.style.top=c.y+"px"),typeof c.z!="undefined"&&(a.style.zIndex=c.z)},getX:function(a,b){return b?parseInt(a.style.left,10)-document.documentElement.scrollLeft:parseInt(a.style.left,10)},getY:function(a,b){return b?parseInt(a.style.top,10)-document.documentElement.scrollTop:parseInt(a.style.top,10)},updateIframe:function(a){this.setFixed(this.iframeNode,a),a&&this.__fixedHandle()},updateOrgPosition:function(){!this.node||(this.__orgX=parseInt(this.node.style.left,10)-document.documentElement.scrollLeft,this.__orgY=parseInt(this.node.style.top,10)-document.documentElement.scrollTop)},destroy:function(){SinaEditor.ev.remove(window,"scroll",this.__fixedHandle),this.__isBindScroll=!1,this.node=null,this.iframeNode=null}}),SinaEditor._.Panel=function(a,b){this.nodes={},this.uniqueID=this.__getUniqueID(),this.entity=null,this.__iframe=null,this.__isSetAdamant=!1,this.__templateNodesIDs=[],this.__isFixed=!1,SinaEditor.env.$IE6&&(this.__ie6FixedController=new SinaEditor._.IE6FixedController)}.$extends(SinaEditor._.DisplayObject).$define({setTemplate:function(a){var b=SinaEditor.util.dom.createDom("div",{properties:{innerHTML:(new SinaEditor.$abstract.Template(a)).evaluate(this.__getNodes(a,"i"))}});b.style.display="none",this.__parent.appendChild(b),this.__updateTemplate(b),this.nodes=this.__getNodes(a),this.entity=this.__entity,this.nodes.panel=this.entity;return this},setFixed:function(a){this.__isInited||this.__initEntity();var b=parseInt(this.__entity.style.left,10),c=parseInt(this.__entity.style.top,10);SinaEditor.env.$IE6?(this.__ie6FixedController.setFixed(this.__entity,a),this.__isSetAdamant&&this.__ie6FixedController.setFixed(this.__iframe,a)):(a&&!this.__isFixed&&(this.setPosition({x:b-Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),y:c-Math.max(document.documentElement.scrollTop,document.body.scrollTop)}),this.__entity.style.position="fixed"),!a&&this.__isFixed&&(this.setPosition({x:b+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),y:c+Math.max(document.documentElement.scrollTop,document.body.scrollTop)}),this.__entity.style.position="absolute")),this.__isFixed=!!a,this.__updateIframe();return this},setAdamant:function(a){this.__isSetAdamant=!!a,this.__isSetAdamant&&!this.__iframe&&this.__createIframe(),this.__updateIframe();return this},destroy:function(){!this.__entity||(SinaEditor._.Panel.$super.destroy.call(this),this.__ie6FixedController&&this.__ie6FixedController.destroy(),this.__iframe&&this.__iframe.parentNode.removeChild(this.__iframe))},setPosition:function(a){this.__isInited||this.__initEntity(),SinaEditor.env.$IE6?this.__ie6FixedController.setPosition(this.__entity,this.__isFixed,a):SinaEditor._.Panel.$super.setPosition.call(this,a),this.__updateIframe();return this},setSize:function(a){SinaEditor._.Panel.$super.setSize.call(this,a).__updateIframe();return this},show:function(a){SinaEditor._.Panel.$super.show.call(this,a).__updateIframe();return this},hidden:function(a){SinaEditor._.Panel.$super.hidden.call(this,a).__updateIframe();return this},__getX:function(){this.__isInited||this.__initEntity();return SinaEditor.env.$IE6?this.__ie6FixedController.getX(this.__entity,this.__isFixed):parseInt(this.__entity.style.left,10)},__getY:function(){this.__isInited||this.__initEntity();return SinaEditor.env.$IE6?this.__ie6FixedController.getY(this.__entity,this.__isFixed):parseInt(this.__entity.style.top,10)},__createIframe:function(){this.__iframe=SinaEditor.util.dom.createDom("iframe",{attributes:{frameBorder:"none"}}),this.__parent.insertBefore(this.__iframe,this.__entity),SinaEditor.util.dom.setStyle(this.__iframe,"opacity",0),this.__ie6FixedController&&(this.__ie6FixedController.iframeNode=this.__iframe),this.__updateIframe()},__updateIframe:function(){if(this.__iframe){var a=this.__iframe.style;a.backgroundColor="#ffffff",a.left=this.x+"px",a.top=this.y+"px",a.width=this.width+"px",a.height=this.height+"px",a.position=this.__entity.style.position,a.display=this.__entity.style.display,a.zIndex=this.__entity.style.zIndex,SinaEditor.env.$IE6&&this.__ie6FixedController.updateIframe(this.__isFixed)}},__updateIE6FCOrgPosition:function(){this.__ie6FixedController&&this.__ie6FixedController.updateOrgPosition()},__updateTemplate:function(a){var b,c,d,e,f,g=this.__entity;g?(g.parentNode&&g.parentNode.removeChild(g),b=g.style.left,c=g.style.top,d=g.style.zIndex,e=g.style.position,f=g.style.display):f="none",g=this.__entity=SinaEditor.util.dom.$E("_"+this.uniqueID+"_panel"),g||(g=this.__entity=SinaEditor.util.dom.$E("_"+this.uniqueID+"_entity"));if(!g)throw new Error("[Panel Error]there missing identifier #{panel} in panel template");g.style.left=b||0,g.style.top=c||0,g.style.zIndex=d||0,g.style.position=e||"absolute",g.style.display=f,this.__parent.replaceChild(g,a),this.__ie6FixedController&&(this.__ie6FixedController.node=this.__entity)},__getNodes:function(a,b){var c=b||"o",d=/\{[^\}]+(?=\})/g,e,f={},g,h;this.__templateNodesIDs=a.match(d),g=this.__templateNodesIDs;if(g){e=g.length;while(e--){h=g[e].replace("{","");switch(c){case"o":f[h]=SinaEditor.util.dom.$E("_"+this.uniqueID+"_"+h);break;case"i":f[h]="_"+this.uniqueID+"_"+h}}}return f},__getUniqueID:function(){return parseInt(Math.random()*1e3,10).toString()+(new Date).getTime().toString()},setContent:function(a){this.nodes.content&&(this.nodes.content.innerHTML=a)}}),SinaEditor._.Dialog=function(a,b){var c=this;this.__dragger=null,this.__isBindUpadateAreaEvent=!1,this.__isBindUpdateIE6AreaEvent=!1,this.__beforeDragHandle=function(){c.__updateDraggerArea(),c.__eventDispatcher.dispatchEvent("beforedrag")},this.__dragHandle=function(){c.__isSetAdamant&&c.__updateIframe(),c.__eventDispatcher.dispatchEvent("drag")},this.__afterDragHandle=function(){c.__isFixed&&SinaEditor.env.$IE6&&c.__updateIE6FCOrgPosition(),c.__eventDispatcher.dispatchEvent("afterdrag")},this.__updateDraggerAreaHandle=function(){setTimeout(function(){c.__updateDraggerArea()},1)},this.__setMiddleHandle=function(){c.setMiddle()}}.$extends(SinaEditor._.Panel).$define({setTemplate:function(a){SinaEditor._.Dialog.$super.setTemplate.call(this,a),this.__initTitleBar(),this.setDragger(SinaEditor._.SimpleDragger);return this},setContent:function(a){if(!this.nodes.content)return this;this.nodes.content.innerHTML=(new SinaEditor.$abstract.Template(a)).evaluate(this.__getNodes(a,"i")),this.__addContentNodes(this.__getNodes(a));return this},setFixed:function(a){SinaEditor._.Dialog.$super.setFixed.call(this,a),a?SinaEditor.ev.add(window,"resize",this.__setMiddleHandle):SinaEditor.ev.remove(window,"resize",this.__setMiddleHandle),this.__updateDraggerArea();return this},setMiddle:function(){var a=this.__getDocumentSize().height-this.height,b=(Math.sqrt(5)-1)/2,c=1,d=a*b/(b+c),e=this.__getDocumentSize().width/2-this.width/2;this.__isFixed||(d+=Math.max(document.documentElement.scrollTop,document.body.scrollTop),e+=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft)),this.setPosition({x:Math.max(e,0),y:Math.max(d,0)});return this},setAreaLocked:function(a){if(!this.__dragger)return this;this.__dragger.setLock(a);return this},setSize:function(a){this.__isInited||this.__initEntity(),this.nodes.content?(typeof a.width!="undefined"&&(this.nodes.content.style.width=a.width+"px"),typeof a.height!="undefined"&&(this.nodes.content.style.height=a.height+"px")):(typeof a.width!="undefined"&&(this.__entity.style.width=a.width+"px"),typeof a.height!="undefined"&&(this.__entity.style.height=a.height+"px"));return this},setDragger:function(a){if(!this.nodes.titleBar||!a)return this;if(!this.__dragger)this.__dragger=new a;else if(this.__dragger.constructor===a)return this;this.__updateDragger(a);return this},destroy:function(){!this.__entity||(SinaEditor._.Dialog.$super.destroy.call(this),SinaEditor
.ev.remove(window,"resize",this.__updateDraggerAreaHandle),SinaEditor.ev.remove(window,"resize",this.__setMiddleHandle))},__addContentNodes:function(a){var b=this.nodes,c;for(c in a)b[c]=a[c]},__updateDragger:function(a){this.__dragger.constructor!==a&&(this.__dragger.removeEventListener("beforedrag",this.__beforeDragHandle).removeEventListener("drag",this.__dragHandle).removeEventListener("afterdrag",this.__afterDragHandle),this.__dragger.destroy(),this.__dragger=new a),this.__dragger.setDrag(this.nodes.titleBar,this.__entity,!1),this.__dragger.addEventListener("beforedrag",this.__beforeDragHandle).addEventListener("drag",this.__dragHandle).addEventListener("afterdrag",this.__afterDragHandle)},__updateDraggerArea:function(){var a,b,c,d;this.__isFixed?(a=SinaEditor.env.$IE6?document.documentElement.scrollLeft:0,b=SinaEditor.env.$IE6?document.documentElement.scrollTop:0,c=SinaEditor.env.$IE6?document.documentElement.scrollLeft+this.__getDocumentSize().width-this.width:this.__getDocumentSize().width-this.width,d=SinaEditor.env.$IE6?document.documentElement.scrollTop+this.__getDocumentSize().height-this.height:this.__getDocumentSize().height-this.height):(a=0,b=0,c=document.documentElement.scrollWidth-this.width,d=document.documentElement.scrollHeight-this.height),this.__dragger.setArea({left:a,top:b,right:c,bottom:d})},__initTitleBar:function(){if(!!this.nodes.titleBar){var a=this.nodes.titleBar;a.style.cursor="move",SinaEditor.env.$IE?SinaEditor.ev.add(a,"selectstart",function(){return!1}):a.style.MozUserSelect="none"}},__getDocumentSize:function(){var a=document.documentElement.clientWidth||document.body.clientWidth,b=document.documentElement.clientHeight||document.body.clientHeight;return{width:a,height:b}}}),SinaEditor._.ModuleDialog=function(a,b,c){this.__bgShadow=null,this.__dialog=null,this.__isInitBgShadow=!1,this.__tplConfig=a,this.__iconSet=b,this.__dialogQueue=[],this.__zIndex=1024,this.__cfg=c||{}}.$define({alert:function(a,b){b=b||{};var c=this.__createMessageDialog(this.__tplConfig.alert,b);c.nodes.text&&(c.nodes.text.innerHTML=a||""),c.show(b.renderer||this.__cfg.renderer).addEventListener("hidden",function(){this.destroy()}),c.nodes.linkOk&&c.nodes.linkOk.style.display!=="none"&&c.nodes.linkOk.focus();return c},confirm:function(a,b){b=b||{};var c=this.__createMessageDialog(this.__tplConfig.confirm,b),d=this;c.nodes.text&&(c.nodes.text.innerHTML=a||""),c.nodes.btnCancel&&(c.nodes.btnCancel.innerHTML=b.textCancel||"取消",SinaEditor.ev.add(c.nodes.btnCancel,"click",function(a){b.funcCancel&&b.funcCancel.call(c),c.hidden(b.renderer||d.__cfg.renderer),SinaEditor.ev.stopEvent(a)}),c.nodes.linkCancel&&SinaEditor.ev.add(c.nodes.linkCancel,"keydown",function(){var a=d.__getEvent();a.keyCode=="13"&&(b.funcCancel&&b.funcCancel.call(c),c.hidden(b.renderer||d.__cfg.renderer))})),c.show(b.renderer||d.__cfg.renderer).addEventListener("hidden",function(){this.destroy()}),parseInt(b.defaultButton,10)===0?c.nodes.linkCancel&&c.nodes.linkCancel.style.display!=="none"&&c.nodes.linkCancel.focus():c.nodes.linkOk&&c.nodes.linkOk.style.display!=="none"&&c.nodes.linkOk.focus();return c},create:function(a){var b=this;a=a||{};var c=new SinaEditor._.Dialog;c.setTemplate(a.tpl||this.__tplConfig.customs),a.content&&c.setContent(a.content),a.width&&!isNaN(a.width)&&c.setSize({width:a.width}),a.height&&!isNaN(a.height)&&c.setSize({height:a.height});return this.__initDialog(c,a)},__createMessageDialog:function(a,b){var c=new SinaEditor._.Dialog,d=this,e;c.setTemplate(a),b.width&&!isNaN(b.width)&&c.setSize({width:b.width}),b.height&&!isNaN(b.height)&&c.setSize({height:b.height}),c.nodes.subText&&(c.nodes.subText.innerHTML=b.subText||""),c.nodes.icon&&(c.nodes.icon.className=this.__iconSet[b.icon||"01"]["class"],c.nodes.icon.alt=this.__iconSet[b.icon||"01"].alt),c.nodes.btnOk&&(c.nodes.btnOk.innerHTML=b.textOk||"确定",SinaEditor.ev.add(c.nodes.btnOk,"click",function(a){c.hidden(b.renderer||d.__cfg.renderer),b.funcOk&&b.funcOk.call(c),SinaEditor.ev.stopEvent(a)})),c.nodes.linkOk&&SinaEditor.ev.add(c.nodes.linkOk,"keydown",function(){var a=d.__getEvent();a.keyCode=="13"&&(c.hidden(b.renderer||d.__cfg.renderer),b.funcOk&&b.funcOk.call(c))}),c.setDragger(b.dragger||d.__cfg.dragger).setFixed(!0).setAreaLocked(!0);return this.__initDialog(c,b)},__initDialog:function(a,b){var c=this;a.nodes.titleName&&(a.nodes.titleName.innerHTML=b.title||"提示"),a.nodes.btnClose&&(SinaEditor.ev.add(a.nodes.btnClose,"click",function(){var c=!0;b.funcBeforeClose&&(c=b.funcBeforeClose.call(a)!==!1),b.funcClose&&b.funcClose.call(a),c&&a.hidden()}),SinaEditor.ev.add(a.nodes.btnClose,"mousedown",function(a){SinaEditor.ev.stopEvent(a)})),a.setPosition({z:c.__zIndex}).setRenderer(b.renderer||this.__cfg.renderer).setDragger(b.dragger||this.__cfg.dragger).setMiddle().addEventListener("beforeHidden",function(){c.__updateDialogQueue(this,"remove")}).addEventListener("beforeShow",function(){var a=this;c.__isInitBgShadow||c.__initBGShadow(this,b.isAdamant||c.__cfg.isAdamant),c.__setBGShadowOpacity(b.bgShadowOpacity!==0?b.bgShadowOpacity||.4:b.bgShadowOpacity),window.setTimeout(function(){c.__bgShadow.show(),c.__updateDialogQueue(a,"add")},1)}),a.setTitle=function(a){this.nodes.titleName&&(this.nodes.titleName.innerHTML=a)},a.setHelp=function(a){this.nodes.btnHelp&&(this.nodes.btnHelp.href=a)},a.close=function(){this.hidden()},a.getNodes=function(){return this.nodes},a.getX=function(){return this.x},a.getY=function(){return this.y},a.getWidth=function(){return this.width},a.getHeight=function(){return this.height};return a},__initBGShadow:function(a,b){var c=this.__getDocumentSize().width,d=this.__getDocumentSize().height,e=this;this.__bgShadow=new SinaEditor._.Panel,this.__bgShadow.setTemplate('<div id="#{panel}" style="background-color:black"></div>').setSize({width:c,height:d}).setAdamant(b).setFixed(!0).setPosition({x:0,y:0,z:e.__zIndex}),SinaEditor.ev.add(window,"resize",function(){e.__bgShadow.setPosition({x:0,y:0}).setSize({width:e.__getDocumentSize().width,height:e.__getDocumentSize().height})}),this.__bgShadow.nodes.panel.parentNode.insertBefore(this.__bgShadow.nodes.panel,a.nodes.panel),this.__isInitBgShadow=!0},__updateDialogQueue:function(a,b){var c,d;if(b==="add")this.__dialogQueue.push(a);else if(b==="remove"){c=this.__dialogQueue.length;while(c--)this.__dialogQueue[c]===a&&this.__dialogQueue.splice(c,1)}this.__dialogQueue.length===0?this.__bgShadow.hidden():(d=this.__dialogQueue[this.__dialogQueue.length-1],d.nodes.panel.parentNode.appendChild(d.nodes.panel),this.__bgShadow.nodes.panel.parentNode.insertBefore(this.__bgShadow.nodes.panel,d.nodes.panel),this.__bgShadow.__iframe&&this.__bgShadow.__iframe.parentNode.insertBefore(this.__bgShadow.__iframe,this.__bgShadow.nodes.panel),d.nodes.linkOk&&d.nodes.linkOk.style.display!=="none"&&d.nodes.linkOk.focus())},__setBGShadowOpacity:function(a){a=isNaN(a)?0:Math.max(Math.min(a,1),0),SinaEditor.util.dom.setStyle(this.__bgShadow.nodes.panel,"opacity",a)},__getDocumentSize:function(){var a=document.documentElement.clientWidth||document.body.clientWidth,b=document.documentElement.clientHeight||document.body.clientHeight;return{width:a,height:b}},__getEvent:function(){if(window.event)return window.event;var a=arguments.callee.caller,b,c=0;while(a!==null&&c<40){b=a.arguments[0];if(!b||b.constructor!=Event&&b.constructor!=MouseEvent)c++,a=a.caller;else return b}return b}}),SinaEditor.winDialog={},function(){var a={alert:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示标题</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}" class="CP_layercon1">','<div class="CP_prompt">','<img id="#{icon}" class="SG_icon SG_icon201" width="50" height="50" align="absmiddle"/>','<table class="CP_w_ttl"><tr><td id="#{text}"></td></tr></table>','<div id="#{subText}" class="CP_w_cnt SG_txtb"></div>','<p class="CP_w_btns_Mid"><a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnOk}"> </cite></a></p>',"</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),confirm:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示标题</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}" class="CP_layercon1">','<div class="CP_prompt">','<img id="#{icon}" class="SG_icon SG_icon201" src="',SinaEditor.CONF.transparentIMG,'" width="50" height="50" align="absmiddle"/>','<table class="CP_w_ttl"><tr><td id="#{text}"></td></tr></table>','<div id="#{subText}" class="CP_w_cnt SG_txtb"></div>','<p class="CP_w_btns">','<a  id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnOk}"></cite></a>','<a style="margin-left:5px;" id="#{linkCancel}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnCancel}"> <span id="#{cancel}"></span> </cite></a></p>',"</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),customs:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}">提示标题</strong>','<cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">',"</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join("")},b={"01":{"class":"SG_icon SG_icon201",alt:"警告"},"02":{"class":"SG_icon SG_icon202",alt:"失败"},"03":{"class":"SG_icon SG_icon203",alt:"成功"},"04":{"class":"SG_icon SG_icon204",alt:"询问"}};SinaEditor.winDialog=new SinaEditor._.ModuleDialog(a,b,{renderer:SinaEditor._.OpacityRenderer,dragger:SinaEditor._.BorderDragger,isAdamant:SinaEditor.env.$IE6})}()
